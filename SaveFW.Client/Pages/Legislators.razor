@using SaveFW.Shared
@inject HttpClient Http

<section class="bg-[#0f172a] py-24 relative overflow-hidden">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
        <div class="mb-12 text-center max-w-4xl mx-auto">
            <h2 class="text-3xl font-black tracking-tight text-white sm:text-4xl">
                CONTACT YOUR <span class="text-blue-500">LEGISLATORS</span>
            </h2>
            <p class="mt-4 text-xl italic text-slate-400 font-medium max-w-2xl mx-auto">
                Make your voice heard.
            </p>
        </div>

        @if (legislators == null)
        {
            <div class="text-center text-white">Loading...</div>
        }
        else
        {
            <div class="grid md:grid-cols-2 gap-8">
                <!-- City Council -->
                <div>
                    <h3 class="text-xl font-bold text-white mb-4 border-b border-slate-700 pb-2">Fort Wayne City Council</h3>
                    <div class="space-y-4">
                        @foreach (var p in legislators.Where(l => l.Type == "City Council"))
                        {
                            <div class="bg-slate-800 p-4 rounded-xl border border-slate-700">
                                <div class="font-bold text-white">@p.Name</div>
                                <div class="text-sm text-blue-400">@p.District</div>
                                <a href="mailto:@p.Email" class="text-sm text-slate-400 hover:text-white transition-colors">@p.Email</a>
                            </div>
                        }
                    </div>
                </div>

                <!-- State House -->
                <div>
                    <h3 class="text-xl font-bold text-white mb-4 border-b border-slate-700 pb-2">Indiana State House</h3>
                    <div class="space-y-4">
                        @foreach (var p in legislators.Where(l => l.Type == "State House"))
                        {
                            <div class="bg-slate-800 p-4 rounded-xl border border-slate-700">
                                <div class="font-bold text-white">@p.Name</div>
                                <div class="text-sm text-blue-400">@p.District (@p.Party)</div>
                                <a href="mailto:@p.Email" class="text-sm text-slate-400 hover:text-white transition-colors">@p.Email</a>
                            </div>
                        }
                    </div>
                </div>
            </div>
        }
    </div>
</section>

@code {
    private Legislator[]? legislators;

    protected override async Task OnInitializedAsync()
    {
        try 
        {
            legislators = await Http.GetFromJsonAsync<Legislator[]>("api/legislators");
        }
        catch(Exception ex)
        {
            Console.WriteLine($"Error fetching legislators: {ex.Message}");
        }
    }
}
