@inject IJSRuntime JSRuntime
@using SaveFW.Client.Pages

<section class="bg-[#0f172a] py-24 relative overflow-hidden" id="economic-analysis">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8">
        <div class="mb-12 text-center max-w-4xl mx-auto" id="economic-analysis-header">
            <span class="text-blue-500 font-bold tracking-wider uppercase text-sm mb-2 block">Economic Analysis</span>
            <h2 class="text-3xl font-black tracking-tight text-white sm:text-4xl">
                ECONOMIC <span class="text-blue-500">IMPACT</span> CALCULATOR
            </h2>
        </div>

            <!-- Social Costs Card -->
            <div
                class="bg-slate-800 border border-slate-700 dark:bg-surface-dark border border-slate-200 dark:border-slate-800 rounded-3xl p-8 shadow-lg mb-12">
                <div class="flex flex-col gap-6">
                    <div>
                        <h3 class="text-xl font-bold text-slate-300 dark:text-white mb-2 flex items-center gap-2">
                            <span class="material-symbols-outlined text-red-600">receipt_long</span>
                            "Hidden" Price Tag: Social Costs
                        </h3>
                        <p class="text-slate-400 dark:text-slate-400 leading-relaxed mb-4">
                            The State's commissioned "market analysis" by Spectrum Gaming was strictly limited to
                            evaluating <strong>Adjusted Gross Receipts (AGR)</strong>—essentially, how much money the
                            casino could take from residents. It was not a social impact study. By design, it ignored
                            the "line item" costs of crime, embezzlement, and family erosion, presenting a one-sided
                            ledger that counts revenue as "profit" while hiding the expense bill sent to taxpayers.
                        </p>
                        <p
                            class="text-slate-400 dark:text-slate-400 leading-relaxed border-t border-slate-700 pt-4 mb-8">
                            Relying on such a narrow study to justify one of the most expensive and permanent
                            infrastructure projects in our city's history is malpractice. To proceed with this
                            irreversible decision while actively blocking a voter referendum removes the only
                            check-and-balance capable of forcing a full accounting of these costs.
                        </p>

                        <!-- The Builder's Bias Expansion -->
                        <!-- 
                        <div class="bg-slate-900/50 rounded-2xl p-6 border border-slate-700">
                            <h4 class="text-xl font-bold text-orange-500 mb-6 flex items-center gap-2">
                                <span class="material-symbols-outlined text-2xl">engineering</span>
                                The Builder's Bias: Who Really Profits?
                            </h4>
                            <p class="text-slate-300 text-base leading-relaxed mb-6">
                                The "FWFirst" campaign isn't a grassroots movement; it is an operation by <strong>Greater Fort Wayne Inc. (The Chamber)</strong>. They represent the construction firms, developers, and other special interest groups that stand to make millions from the <em>construction</em> of the casino, regardless of whether it bankrupts the community later.
                            </p>
                            
                            <div class="grid md:grid-cols-1 gap-6 mb-8">
                                <div class="bg-slate-800 p-6 rounded-xl border-l-4 border-red-500">
                                    <h5 class="text-white font-bold text-base mb-2">The Bluff</h5>
                                    <p class="text-slate-400 leading-relaxed">
                                        Ads claiming "It's Coming" are a deception designed to make you give up. The bill has only passed one committee. It is far from a done deal.
                                    </p>
                                </div>
                            </div>

                            <div class="mb-8">
                                <div class="flex justify-between items-end mb-4">
                                    <span class="text-sm font-bold text-slate-400 uppercase tracking-wider">Revenue Projections & The "Tribal Paradox"</span>
                                </div>
                                <div class="space-y-3 font-medium">
                                    
                                    <div class="w-full bg-slate-800 h-10 rounded-lg overflow-hidden relative">
                                        <div class="bg-orange-500 h-full flex items-center px-4 text-sm font-bold text-white whitespace-nowrap" style="width: 100%">
                                            Greater Fort Wayne Inc.'s FWFirst "Sales Pitch" (Union Gaming): $330.7M
                                        </div>
                                    </div>

                                    <div class="w-full bg-slate-800 h-10 rounded-lg overflow-hidden relative">
                                        <div class="bg-blue-600 h-full flex items-center px-4 text-sm font-bold text-white whitespace-nowrap" style="width: 61%">
                                            State of Indiana's Spectrum Gaming Study (No Tribal Competition): $204M
                                        </div>
                                    </div>

                                    <div class="w-full bg-slate-800 h-10 rounded-lg overflow-hidden relative">
                                        <div class="bg-slate-600 h-full flex items-center px-4 text-sm font-bold text-white whitespace-nowrap" style="width: 13%">
                                            State of Indiana's Spectrum Gaming Study (Tribal Competition): $43M
                                        </div>
                                    </div>
                                </div>

                                <div class="mt-4 bg-red-900/20 border border-red-500/30 p-4 rounded-xl">
                                    <strong class="text-red-400 uppercase tracking-wide block mb-1">Caught in a Trap</strong>
                                    <p class="text-slate-300 leading-relaxed">
                                        The $330M projection likely assumes <strong>zero Tribal competition</strong>. If they admitted the Tribe is a threat (as they do when scaring the public), their revenue model would likely decrease to the $50M-$100M range. The City and the Chamber need the Tribal threat to "exist" to pass the bill quickly. When it comes time for the casino to secure financing, the Tribal threat will be a non-factor (see "Tribal Fact Check" section). Meanwhile, residents are stripped of their ability to vote on the casino, which has been the historical precedence for other cities within the State of Indiana. All the while, the same residents will have to bare the social cost burden caused by the casino.
                                    </p>
                                </div>
                            </div>

                            <div class="flex items-start gap-4 bg-red-900/20 p-4 rounded-xl border border-red-900/50">
                                <div>
                                    <strong class="text-red-400 text-base block mb-1">"5,520 Jobs" Myth</strong>
                                    <p class="text-slate-300 text-md leading-relaxed">
                                        The Chamber loves this number. The reality? They are mostly <strong>temporary construction jobs</strong>. Once the concrete dries, those workers leave, and the taxpayers are left with the 30-year social bill. In a tight labor market, the 1,024 projected permanent jobs gains will likely be negated by job losses from local small businesses (restaurants, bars, etc.) that are canabilized by the casino.
                                    </p>
                                </div>
                            </div>
                        </div>
                        -->
                    </div>
                </div>
            </div>

        <Map />
        <!-- Calculator Grid -->
        <div class="flex flex-col gap-12 mb-16">

            <!-- Controls Card -->
            <div id="calculator-controls"
                class="bg-slate-800 border border-slate-700 rounded-3xl p-4 sm:p-8 w-full shadow-sm">
                <h3 class="text-xl font-bold text-slate-300 dark:text-white mb-2">
                    <span class="material-symbols-outlined text-blue-500">tune</span>
                    Economic Inputs
                </h3>
                <div class="space-y-5">
                    <!-- Simulator Trigger -->
                    <div class="-mb-8">
                        <button onclick="openSimulatorModal()"
                            class="w-full bg-gradient-to-r from-blue-600 to-cyan-500 hover:from-blue-500 hover:to-cyan-400 text-white font-bold py-4 px-6 rounded-xl shadow-lg shadow-blue-500/20 border border-blue-400/30 flex items-center justify-between group transition-all transform active:scale-95 mt-10">
                            <div class="flex items-center gap-3">
                                <div class="bg-white/20 p-2 rounded-lg">
                                    <span class="material-symbols-outlined text-white">science</span>
                                </div>
                                <div class="text-left">
                                    <div class="uppercase tracking-wide text-xs font-bold text-blue-100 mb-0.5">Quick
                                        Start</div>
                                    <div class="text-lg leading-none">Run Scenario Simulator</div>
                                </div>
                            </div>
                            <span
                                class="material-symbols-outlined group-hover:translate-x-1 transition-transform">arrow_forward</span>
                        </button>

                        <div class="relative flex py-8 items-center justify-center mt-10">
                            <div class="absolute inset-0 flex items-center" aria-hidden="true">
                                <div class="w-full border-t border-slate-700"></div>
                            </div>
                            <div class="relative flex justify-center">
                                <button onclick="toggleManualControls()" id="btn-manual-toggle"
                                    class="bg-gradient-to-r from-purple-600 to-blue-600 hover:from-purple-500 hover:to-blue-500 text-white font-bold py-2 px-6 rounded-full border border-purple-400/30 flex items-center gap-2 transition-all text-xs uppercase tracking-wider group shadow-lg active:scale-95">
                                    <span>Adjust Variables Manually</span>
                                    <span
                                        class="material-symbols-outlined group-hover:translate-y-1 transition-transform text-lg">expand_more</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Collapsible Manual Controls -->
                    <div id="manual-controls"
                        class="rounded-2xl px-4 sm:px-6 py-8 transition-all duration-500 ease-in-out overflow-hidden max-h-0 opacity-0">
                        <!-- AGR Input -->
                        <div class="border-b border-slate-700 pb-8">
                            <div class="flex justify-between items-end mb-4">
                                <label class="text-base font-bold text-white">Adjusted Gross Revenue (AGR)</label>
                                <span class="text-emerald-400 font-bold font-mono" id="val-agr">$0 MM</span>
                            </div>
                            <div class="relative w-full group flex items-center  overflow-visible">
                                <input type="range" min="0" max="1000" step="1" value="112" data-default="112"
                                    id="input-agr"
                                    class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-emerald-500 relative z-20">
                            </div>

                            <!-- Tax Details (Always Visible) -->
                            <div id="tax-details-container"
                                class="bg-slate-900/80 rounded-lg p-4 mt-20 text-sm font-mono text-slate-300 border border-slate-700 shadow-inner">
                                <!-- Populated by JS -->
                            </div>
                        </div>

                        <!-- Revenue Input -->
                        <div>
                            <div class="flex justify-between items-end mb-4">
                                <div class="flex flex-col">
                                    <label class="text-base font-bold text-white">Tax Revenue</label>
                                    <p class="text-xs text-slate-400 italic">Default: Spectrum Gaming Projection
                                        ($27.5MM)</p>
                                </div>
                                <span class="text-emerald-500 font-bold font-mono" id="val-revenue">$27.5 MM</span>
                            </div>
                            <div class="relative w-full group flex items-center  overflow-visible">
                                <input type="range" min="0" max="400" step="0.5" value="27.5" data-default="27.5"
                                    id="input-revenue"
                                    class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-emerald-500 relative z-20">

                                <input type="radio" name="revenue-default" value="27.5"
                                    class="absolute top-1/2 -translate-y-1/2 -translate-x-1/2 z-30 w-4 h-4 appearance-none rounded-full border-2 border-slate-400 bg-slate-900 checked:bg-[radial-gradient(circle,_#fff_35%,_#10b981_40%)] checked:border-emerald-500 pointer-events-none transition-all group-hover:scale-110"
                                    style="left: calc(6.875% + 6.33px)">

                                <!-- Default Label -->
                                <div class="absolute top-1/2 -translate-x-1/2 flex flex-col items-center group/lbl z-50 pointer-events-none"
                                    style="left: calc(6.875% + 6.33px)">
                                    <div class="h-10 w-px bg-slate-500/50 mb-1"></div>
                                    <div
                                        class="flex items-center gap-1 cursor-help hover:text-blue-500 transition-colors text-[10px] text-slate-400 uppercase font-bold tracking-wider pointer-events-auto relative">
                                        <span>Default</span>
                                        <span class="material-symbols-outlined text-[12px]">info</span>
                                        <div
                                            class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-64 p-2 bg-slate-800 text-white text-xs leading-tight rounded border border-slate-600 opacity-0 group-hover/lbl:opacity-100 transition-opacity pointer-events-none z-50 normal-case font-normal text-center shadow-lg">
                                            This represents the primary projection from the Spectrum Gaming Group study.
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Revenue Allocation Control -->
                        <div class="pt-6">
                            <div class="flex flex-col mb-3 mt-10">
                                <label class="text-base font-bold text-white">Tax Revenue Allocation</label>
                                <p class="text-sm text-slate-400 italic">
                                    Drag to adjust the split between the Humanitarian Fund and General Taxpayer
                                    Services.
                                </p>
                            </div>

                            <!-- Visual Bar / Slider Wrapper -->
                            <div
                                class="relative h-10 w-full rounded-xl overflow-hidden cursor-pointer group shadow-inner border border-slate-600">
                                <!-- Backgrounds -->
                                <div class="absolute inset-0 flex">
                                    <div id="alloc-bar-human"
                                        class="h-full bg-purple-600 transition-all duration-75 flex items-center pl-3 overflow-hidden"
                                        style="width: 40%">
                                        <span
                                            class="text-xs sm:text-sm font-bold text-white whitespace-nowrap drop-shadow-md">Humanitarian</span>
                                    </div>
                                    <div id="alloc-bar-taxpayer"
                                        class="h-full bg-emerald-600 transition-all duration-75 flex items-center justify-end pr-3 overflow-hidden"
                                        style="width: 60%">
                                        <span
                                            class="text-xs sm:text-sm font-bold text-white whitespace-nowrap drop-shadow-md">Taxpayer
                                            Services</span>
                                    </div>
                                </div>

                                <!-- Percentage Overlay (Centered) -->
                                <div
                                    class="absolute inset-0 flex justify-center items-center pointer-events-none gap-4">
                                    <div class="bg-slate-900/80 px-2 py-1 rounded text-sm font-mono font-bold text-purple-300 border border-purple-500/30"
                                        id="alloc-text-human">40%</div>
                                    <div class="bg-slate-900/80 px-2 py-1 rounded text-sm font-mono font-bold text-emerald-300 border border-emerald-500/30"
                                        id="alloc-text-taxpayer">60%</div>
                                </div>

                                <!-- Hidden Range Input -->
                                <input type="range" min="0" max="100" step="1" value="40" id="input-allocation"
                                    class="absolute inset-0 w-full h-full opacity-0 cursor-ew-resize z-20"
                                    aria-label="Revenue Allocation">
                            </div>
                        </div>

                        <!-- Social Cost Input -->
                        <div class="pb-10">
                            <div class="mb-4 mt-10">
                                <label class="text-base font-bold text-white block mb-2">Social Cost
                                    Variables (Per Problem Gambler)</label>
                                <div class="flex justify-between items-baseline mb-2 bg-slate-800 p-2 rounded-lg">
                                    <span class="text-sm font-bold text-slate-500 uppercase">Total Cost</span>
                                    <span class="text-red-500 font-bold font-mono text-lg"
                                        id="val-cost-total">$13,203</span>
                                </div>
                                <p class="text-sm text-slate-400 italic mb-4">Default values based on Grinols (2011)
                                    ($9,393) adjusted for 2025 inflation ($13,205).</p>
                            </div>

                            <div class="space-y-24 pl-2">
                                <!-- Crime -->
                                <div>
                                    <div class="flex justify-between items-center mb-1">
                                        <div class="flex items-center gap-1.5">
                                            <label class="text-sm font-medium text-slate-400">Crime
                                                Costs</label>
                                            <div class="group relative flex items-center">
                                                <span
                                                    class="material-symbols-outlined text-slate-400 text-[16px] cursor-help hover:text-blue-500 transition-colors">info</span>
                                                <div
                                                    class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-48 p-3 bg-slate-900 dark:bg-slate-800 text-white text-xs rounded-lg shadow-xl border border-slate-700 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-50">
                                                    Includes costs for police, adjudication, and incarceration related
                                                    to gambling-induced crime.
                                                    <div
                                                        class="absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-slate-900 dark:border-t-slate-800">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <span class="text-lg font-bold font-mono text-white"
                                            id="val-cost-crime">$1,625</span>
                                    </div>
                                    <div class="relative w-full group flex items-center  overflow-visible">
                                        <input type="range" min="0" max="10000" step="25" value="1625"
                                            data-default="1625.0" id="input-cost-crime"
                                            class="w-full h-1 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-red-500 relative z-20">
                                        <input type="radio" name="crime-default" value="1625"
                                            class="absolute top-1/2 -translate-y-1/2 -translate-x-1/2 z-30 w-4 h-4 appearance-none rounded-full border-2 border-slate-400 bg-slate-900 checked:bg-[radial-gradient(circle,_#fff_35%,_#ef4444_40%)] checked:border-red-500 pointer-events-none transition-all group-hover:scale-110"
                                            style="left: calc(16.25% + 6.75px)">

                                        <!-- Default Label -->
                                        <div class="absolute top-1/2 -translate-x-1/2 flex flex-col items-center group/lbl z-50 pointer-events-none"
                                            style="left: calc(16.25% + 6.75px)">
                                            <div class="h-10 w-px bg-slate-500/50 mb-1"></div>
                                            <div
                                                class="flex items-center gap-1 cursor-help hover:text-blue-500 transition-colors text-[10px] text-slate-400 uppercase font-bold tracking-wider pointer-events-auto relative">
                                                <span>Default</span>
                                                <span class="material-symbols-outlined text-[12px]">info</span>
                                                <div
                                                    class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-64 p-2 bg-slate-800 text-white text-xs leading-tight rounded border border-slate-600 opacity-0 group-hover/lbl:opacity-100 transition-opacity pointer-events-none z-50 normal-case font-normal text-center shadow-lg">
                                                    This is the inflation-adjusted default value based on Grinols
                                                    (2011).
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- Business -->
                                <div>
                                    <div class="flex justify-between items-center mb-1">
                                        <div class="flex items-center gap-1.5">
                                            <label class="text-sm font-medium text-slate-400">Lost
                                                Employment</label>
                                            <div class="group relative flex items-center">
                                                <span
                                                    class="material-symbols-outlined text-slate-400 text-[16px] cursor-help hover:text-blue-500 transition-colors">info</span>
                                                <div
                                                    class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-48 p-3 bg-slate-900 dark:bg-slate-800 text-white text-xs rounded-lg shadow-xl border border-slate-700 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-50">
                                                    Economic losses due to lost productivity, absenteeism, and
                                                    unemployment.
                                                    <div
                                                        class="absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-slate-900 dark:border-t-slate-800">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <span class="text-lg font-bold font-mono text-white"
                                            id="val-cost-business">$4,051</span>
                                    </div>
                                    <div class="relative w-full group flex items-center  overflow-visible">
                                        <input type="range" min="0" max="10000" step="50" value="4051"
                                            data-default="4051.0" id="input-cost-business"
                                            class="w-full h-1 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-red-500 relative z-20">
                                        <input type="radio" name="business-default" value="4051"
                                            class="absolute top-1/2 -translate-y-1/2 -translate-x-1/2 z-30 w-4 h-4 appearance-none rounded-full border-2 border-slate-400 bg-slate-900 checked:bg-[radial-gradient(circle,_#fff_35%,_#ef4444_40%)] checked:border-red-500 pointer-events-none transition-all group-hover:scale-110"
                                            style="left: calc(40.51% + 1.90px)">

                                        <!-- Default Label -->
                                        <div class="absolute top-1/2 -translate-x-1/2 flex flex-col items-center group/lbl z-50 pointer-events-none"
                                            style="left: calc(40.51% + 1.90px)">
                                            <div class="h-10 w-px bg-slate-500/50 mb-1"></div>
                                            <div
                                                class="flex items-center gap-1 cursor-help hover:text-blue-500 transition-colors text-[10px] text-slate-400 uppercase font-bold tracking-wider pointer-events-auto relative">
                                                <span>Default</span>
                                                <span class="material-symbols-outlined text-[12px]">info</span>
                                                <div
                                                    class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-64 p-2 bg-slate-800 text-white text-xs leading-tight rounded border border-slate-600 opacity-0 group-hover/lbl:opacity-100 transition-opacity pointer-events-none z-50 normal-case font-normal text-center shadow-lg">
                                                    This is the inflation-adjusted default value based on Grinols
                                                    (2011).
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- Bankruptcy -->
                                <div>
                                    <div class="flex justify-between items-center mb-1">
                                        <div class="flex items-center gap-1.5">
                                            <label class="text-sm font-medium text-slate-400">Bankruptcy</label>
                                            <div class="group relative flex items-center">
                                                <span
                                                    class="material-symbols-outlined text-slate-400 text-[16px] cursor-help hover:text-blue-500 transition-colors">info</span>
                                                <div
                                                    class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-48 p-3 bg-slate-900 dark:bg-slate-800 text-white text-xs rounded-lg shadow-xl border border-slate-700 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-50">
                                                    Legal costs and resource drain associated with filings, debts, and
                                                    civil proceedings.
                                                    <div
                                                        class="absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-slate-900 dark:border-t-slate-800">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <span class="text-lg font-bold font-mono text-white"
                                            id="val-cost-bankruptcy">$431</span>
                                    </div>
                                    <div class="relative w-full group flex items-center  overflow-visible">
                                        <input type="range" min="0" max="10000" step="10" value="431"
                                            data-default="431.0" id="input-cost-bankruptcy"
                                            class="w-full h-1 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-red-500 relative z-20">
                                        <input type="radio" name="bankruptcy-default" value="431"
                                            class="absolute top-1/2 -translate-y-1/2 -translate-x-1/2 z-30 w-4 h-4 appearance-none rounded-full border-2 border-slate-400 bg-slate-900 checked:bg-[radial-gradient(circle,_#fff_35%,_#ef4444_40%)] checked:border-red-500 pointer-events-none transition-all group-hover:scale-110"
                                            style="left: calc(4.31% + 9.14px)">

                                        <!-- Default Label -->
                                        <div class="absolute top-1/2 -translate-x-1/2 flex flex-col items-center group/lbl z-50 pointer-events-none"
                                            style="left: calc(4.31% + 9.14px)">
                                            <div class="h-10 w-px bg-slate-500/50 mb-1"></div>
                                            <div
                                                class="flex items-center gap-1 cursor-help hover:text-blue-500 transition-colors text-[10px] text-slate-400 uppercase font-bold tracking-wider pointer-events-auto relative">
                                                <span>Default</span>
                                                <span class="material-symbols-outlined text-[12px]">info</span>
                                                <div
                                                    class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-64 p-2 bg-slate-800 text-white text-xs leading-tight rounded border border-slate-600 opacity-0 group-hover/lbl:opacity-100 transition-opacity pointer-events-none z-50 normal-case font-normal text-center shadow-lg">
                                                    This is the inflation-adjusted default value based on Grinols
                                                    (2011).
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- Illness -->
                                <div>
                                    <div class="flex justify-between items-center mb-1">
                                        <div class="flex items-center gap-1.5">
                                            <label class="text-sm font-medium text-slate-400">Illness</label>
                                            <div class="group relative flex items-center">
                                                <span
                                                    class="material-symbols-outlined text-slate-400 text-[16px] cursor-help hover:text-blue-500 transition-colors">info</span>
                                                <div
                                                    class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-48 p-3 bg-slate-900 dark:bg-slate-800 text-white text-xs rounded-lg shadow-xl border border-slate-700 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-50">
                                                    Healthcare costs for treating stress-related disorders, depression,
                                                    and anxiety.
                                                    <div
                                                        class="absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-slate-900 dark:border-t-slate-800">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <span class="text-lg font-bold font-mono text-white"
                                            id="val-cost-illness">$1,328</span>
                                    </div>
                                    <div class="relative w-full group flex items-center  overflow-visible">
                                        <input type="range" min="0" max="10000" step="25" value="1328"
                                            data-default="1328.0" id="input-cost-illness"
                                            class="w-full h-1 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-red-500 relative z-20">
                                        <input type="radio" name="illness-default" value="1328"
                                            class="absolute top-1/2 -translate-y-1/2 -translate-x-1/2 z-30 w-4 h-4 appearance-none rounded-full border-2 border-slate-400 bg-slate-900 checked:bg-[radial-gradient(circle,_#fff_35%,_#ef4444_40%)] checked:border-red-500 pointer-events-none transition-all group-hover:scale-110"
                                            style="left: calc(13.28% + 7.34px)">

                                        <!-- Default Label -->
                                        <div class="absolute top-1/2 -translate-x-1/2 flex flex-col items-center group/lbl z-50 pointer-events-none"
                                            style="left: calc(13.28% + 7.34px)">
                                            <div class="h-10 w-px bg-slate-500/50 mb-1"></div>
                                            <div
                                                class="flex items-center gap-1 cursor-help hover:text-blue-500 transition-colors text-[10px] text-slate-400 uppercase font-bold tracking-wider pointer-events-auto relative">
                                                <span>Default</span>
                                                <span class="material-symbols-outlined text-[12px]">info</span>
                                                <div
                                                    class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-64 p-2 bg-slate-800 text-white text-xs leading-tight rounded border border-slate-600 opacity-0 group-hover/lbl:opacity-100 transition-opacity pointer-events-none z-50 normal-case font-normal text-center shadow-lg">
                                                    This is the inflation-adjusted default value based on Grinols
                                                    (2011).
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- Social Services -->
                                <div>
                                    <div class="flex justify-between items-center mb-1">
                                        <div class="flex items-center gap-1.5">
                                            <label class="text-sm font-medium text-slate-400">Social
                                                Services</label>
                                            <div class="group relative flex items-center">
                                                <span
                                                    class="material-symbols-outlined text-slate-400 text-[16px] cursor-help hover:text-blue-500 transition-colors">info</span>
                                                <div
                                                    class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-48 p-3 bg-slate-900 dark:bg-slate-800 text-white text-xs rounded-lg shadow-xl border border-slate-700 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-50">
                                                    Public costs for unemployment benefits, welfare programs, and social
                                                    safety nets.
                                                    <div
                                                        class="absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-slate-900 dark:border-t-slate-800">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <span class="text-lg font-bold font-mono text-white"
                                            id="val-cost-services">$713</span>
                                    </div>
                                    <div class="relative w-full group flex items-center  overflow-visible">
                                        <input type="range" min="0" max="10000" step="25" value="713"
                                            data-default="713.0" id="input-cost-services"
                                            class="w-full h-1 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-red-500 relative z-20">
                                        <input type="radio" name="services-default" value="713"
                                            class="absolute top-1/2 -translate-y-1/2 -translate-x-1/2 z-30 w-4 h-4 appearance-none rounded-full border-2 border-slate-400 bg-slate-900 checked:bg-[radial-gradient(circle,_#fff_35%,_#ef4444_40%)] checked:border-red-500 pointer-events-none transition-all group-hover:scale-110"
                                            style="left: calc(7.13% + 8.57px)">

                                        <!-- Default Label -->
                                        <div class="absolute top-1/2 -translate-x-1/2 flex flex-col items-center group/lbl z-50 pointer-events-none"
                                            style="left: calc(7.13% + 8.57px)">
                                            <div class="h-10 w-px bg-slate-500/50 mb-1"></div>
                                            <div
                                                class="flex items-center gap-1 cursor-help hover:text-blue-500 transition-colors text-[10px] text-slate-400 uppercase font-bold tracking-wider pointer-events-auto relative">
                                                <span>Default</span>
                                                <span class="material-symbols-outlined text-[12px]">info</span>
                                                <div
                                                    class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-64 p-2 bg-slate-800 text-white text-xs leading-tight rounded border border-slate-600 opacity-0 group-hover/lbl:opacity-100 transition-opacity pointer-events-none z-50 normal-case font-normal text-center shadow-lg">
                                                    This is the inflation-adjusted default value based on Grinols
                                                    (2011).
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <!-- Abused Dollars -->
                                <div>
                                    <div class="flex justify-between items-center mb-1">
                                        <div class="flex items-center gap-1.5">
                                            <label class="text-sm font-medium text-slate-400">Abused
                                                Dollars</label>
                                            <div class="group relative flex items-center">
                                                <span
                                                    class="material-symbols-outlined text-slate-400 text-[16px] cursor-help hover:text-blue-500 transition-colors">info</span>
                                                <div
                                                    class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-48 p-3 bg-slate-900 dark:bg-slate-800 text-white text-xs rounded-lg shadow-xl border border-slate-700 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-50">
                                                    Financial impact of 'borrowed' or stolen family funds, plus divorce
                                                    and domestic instability costs.
                                                    <div
                                                        class="absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-slate-900 dark:border-t-slate-800">
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <span class="text-lg font-bold font-mono text-white"
                                            id="val-cost-abused">$5,055</span>
                                    </div>
                                    <div class="relative w-full group flex items-center  overflow-visible">
                                        <input type="range" min="0" max="10000" step="50" value="5055"
                                            data-default="5055.0" id="input-cost-abused"
                                            class="w-full h-1 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-red-500 relative z-20">
                                        <input type="radio" name="abused-default" value="5055"
                                            class="absolute top-1/2 -translate-y-1/2 -translate-x-1/2 z-30 w-4 h-4 appearance-none rounded-full border-2 border-slate-400 bg-slate-900 checked:bg-[radial-gradient(circle,_#fff_35%,_#ef4444_40%)] checked:border-red-500 pointer-events-none transition-all group-hover:scale-110"
                                            style="left: calc(50.55% + -0.11px)">

                                        <!-- Default Label -->
                                        <div class="absolute top-1/2 -translate-x-1/2 flex flex-col items-center group/lbl z-50 pointer-events-none"
                                            style="left: calc(50.55% - 0.11px)">
                                            <div class="h-10 w-px bg-slate-500/50 mb-1"></div>
                                            <div
                                                class="flex items-center gap-1 cursor-help hover:text-blue-500 transition-colors text-[10px] text-slate-400 uppercase font-bold tracking-wider pointer-events-auto relative">
                                                <span>Default</span>
                                                <span class="material-symbols-outlined text-[12px]">info</span>
                                                <div
                                                    class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-64 p-2 bg-slate-800 text-white text-xs leading-tight rounded border border-slate-600 opacity-0 group-hover/lbl:opacity-100 transition-opacity pointer-events-none z-50 normal-case font-normal text-center shadow-lg">
                                                    This is the inflation-adjusted default value based on Grinols
                                                    (2011).
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Tax Revenue Calculation -->
                            <div
                                class="mt-20 mb-6 relative z-10 bg-slate-900/50 rounded-xl p-4 border border-slate-600">
                                <div
                                    class="text-xs text-slate-400 uppercase tracking-widest font-bold mb-4 text-center">
                                    Tax Revenue Calculation</div>
                                <div
                                    class="grid grid-cols-[1fr_auto_1fr_auto_1fr] gap-2 items-center text-base sm:text-lg">
                                    <div class="flex flex-col items-center">
                                        <span
                                            class="text-slate-500 text-xs uppercase font-bold mb-1 text-center">Adjusted
                                            Gross Revenue</span>
                                        <span class="text-white font-mono font-bold" id="calc-agr">-</span>
                                    </div>
                                    <div class="text-slate-500 font-bold mb-3">×</div>
                                    <div class="flex flex-col items-center">
                                        <span
                                            class="text-slate-500 text-xs uppercase font-bold mb-1 text-center">Effective
                                            Tax Rate</span>
                                        <span class="text-white font-mono font-bold" id="calc-tax-rate">-</span>
                                    </div>
                                    <div class="text-slate-500 font-bold mb-3">=</div>
                                    <div class="flex flex-col items-center">
                                        <span class="text-slate-500 text-xs uppercase font-bold mb-1 text-center">Total
                                            Estimated Tax Revenue</span>
                                        <span class="text-white font-mono font-bold" id="calc-tax-total">-</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Tax Revenue Allocation Calculation -->
                            <div
                                class="mb-6 relative z-10 bg-slate-900/50 rounded-xl p-4 border border-slate-600 space-y-8">
                                <!-- Humanitarian -->
                                <div>
                                    <div
                                        class="text-xs text-slate-400 uppercase tracking-widest font-bold mb-4 text-center">
                                        Humanitarian Fund Allocation</div>
                                    <div
                                        class="grid grid-cols-[1fr_auto_1fr_auto_1fr] gap-2 items-center text-base sm:text-lg">
                                        <div class="flex flex-col items-center">
                                            <span
                                                class="text-slate-500 text-xs uppercase font-bold mb-1 text-center">Total
                                                Tax Revenue</span>
                                            <span class="text-white font-mono font-bold" id="calc-rev-total-h">-</span>
                                        </div>
                                        <div class="text-slate-500 font-bold mb-3">×</div>
                                        <div class="flex flex-col items-center">
                                            <span
                                                class="text-slate-500 text-xs uppercase font-bold mb-1 text-center">Allocation
                                                Percentage</span>
                                            <span class="text-white font-mono font-bold" id="calc-alloc-pct-h">-</span>
                                        </div>
                                        <div class="text-slate-500 font-bold mb-3">=</div>
                                        <div class="flex flex-col items-center">
                                            <span
                                                class="text-slate-500 text-xs uppercase font-bold mb-1 text-center">Humanitarian
                                                Fund Total</span>
                                            <span class="text-white font-mono font-bold"
                                                id="calc-alloc-human-val">-</span>
                                        </div>
                                    </div>
                                </div>

                                <!-- General -->
                                <div class="border-t border-slate-700 pt-8">
                                    <div
                                        class="text-xs text-slate-400 uppercase tracking-widest font-bold mb-4 text-center">
                                        General Fund Allocation</div>
                                    <div
                                        class="grid grid-cols-[1fr_auto_1fr_auto_1fr] gap-2 items-center text-base sm:text-lg">
                                        <div class="flex flex-col items-center">
                                            <span
                                                class="text-slate-500 text-xs uppercase font-bold mb-1 text-center">Total
                                                Tax Revenue</span>
                                            <span class="text-white font-mono font-bold" id="calc-rev-total-g">-</span>
                                        </div>
                                        <div class="text-slate-500 font-bold mb-3">×</div>
                                        <div class="flex flex-col items-center">
                                            <span
                                                class="text-slate-500 text-xs uppercase font-bold mb-1 text-center">Allocation
                                                Percentage</span>
                                            <span class="text-white font-mono font-bold" id="calc-alloc-pct-g">-</span>
                                        </div>
                                        <div class="text-slate-500 font-bold mb-3">=</div>
                                        <div class="flex flex-col items-center">
                                            <span
                                                class="text-slate-500 text-xs uppercase font-bold mb-1 text-center">General
                                                Fund Total</span>
                                            <span class="text-white font-mono font-bold"
                                                id="calc-alloc-gen-val">-</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Calculation Breakdown -->
                            <div class="mb-6 relative z-10 bg-slate-900/50 rounded-xl p-4 border border-slate-600">
                                <div
                                    class="text-xs text-slate-400 uppercase tracking-widest font-bold mb-4 text-center">
                                    Problem Gambler Calculation</div>
                                <div
                                    class="grid grid-cols-[1fr_auto_1fr_auto_1fr] gap-2 items-center text-base sm:text-lg">
                                    <div class="flex flex-col items-center">
                                        <span class="text-slate-500 text-xs uppercase font-bold mb-1 text-center">Total
                                            Population</span>
                                        <span class="text-white font-mono font-bold" id="calc-pop">385,410</span>
                                    </div>
                                    <div class="text-slate-500 font-bold mb-3">×</div>
                                    <div class="flex flex-col items-center">
                                        <span
                                            class="text-slate-500 text-xs uppercase font-bold mb-1 text-center">Effective
                                            Rate</span>
                                        <span class="text-white font-mono font-bold" id="calc-rate">2.4%</span>
                                    </div>
                                    <div class="text-slate-500 font-bold mb-3">=</div>
                                    <div class="flex flex-col items-center">
                                        <span class="text-slate-500 text-xs uppercase font-bold mb-1 text-center">New
                                            Problem Gamblers</span>
                                        <span class="text-white font-mono font-bold" id="calc-result">9,250</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Detailed Social Cost Breakdown -->
                            <div class="mb-8 relative z-10 bg-slate-900/50 rounded-xl p-4 border border-slate-600">
                                <div
                                    class="text-sm text-slate-400 uppercase tracking-widest font-bold mb-4 text-center">
                                    Detailed Social Cost Breakdown
                                </div>

                                <div class="space-y-6">
                                    <!-- 1. Public Health -->
                                    <div>
                                        <div class="text-xs text-slate-500 uppercase font-bold mb-2 text-center">Public
                                            Health (Humanitarian Fund)</div>
                                        <div
                                            class="grid grid-cols-[1fr_auto_1fr_auto_1fr] gap-2 items-center text-base sm:text-lg">
                                            <div class="flex flex-col items-center">
                                                <span
                                                    class="text-slate-500 text-xs uppercase font-bold mb-1 text-center">New
                                                    Problem Gamblers</span>
                                                <span class="text-white font-mono font-bold"
                                                    id="calc-break-health-victims">-</span>
                                            </div>
                                            <div class="text-slate-500 font-bold mb-3">×</div>
                                            <div class="flex flex-col items-center">
                                                <span
                                                    class="text-slate-500 text-xs uppercase font-bold mb-1 text-center">Cost/Problem
                                                    Gambler</span>
                                                <span class="text-white font-mono font-bold"
                                                    id="calc-break-health-per">-</span>
                                            </div>
                                            <div class="text-slate-500 font-bold mb-3">=</div>
                                            <div class="flex flex-col items-center">
                                                <span
                                                    class="text-slate-500 text-xs uppercase font-bold mb-1 text-center">Total
                                                    Cost</span>
                                                <span class="text-white font-mono font-bold"
                                                    id="calc-break-health-total">-</span>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- 2. Social Services -->
                                    <div class="border-t border-slate-700/50 pt-4">
                                        <div class="text-xs text-slate-500 uppercase font-bold mb-2 text-center">Social
                                            Services (Welfare, Unemployment)</div>
                                        <div
                                            class="grid grid-cols-[1fr_auto_1fr_auto_1fr] gap-2 items-center text-base sm:text-lg">
                                            <div class="flex flex-col items-center">
                                                <span
                                                    class="text-slate-500 text-xs uppercase font-bold mb-1 text-center">New
                                                    Problem Gamblers</span>
                                                <span class="text-white font-mono font-bold"
                                                    id="calc-break-social-victims">-</span>
                                            </div>
                                            <div class="text-slate-500 font-bold mb-3">×</div>
                                            <div class="flex flex-col items-center">
                                                <span
                                                    class="text-slate-500 text-xs uppercase font-bold mb-1 text-center">Cost/Problem
                                                    Gambler</span>
                                                <span class="text-white font-mono font-bold"
                                                    id="calc-break-social-per">-</span>
                                            </div>
                                            <div class="text-slate-500 font-bold mb-3">=</div>
                                            <div class="flex flex-col items-center">
                                                <span
                                                    class="text-slate-500 text-xs uppercase font-bold mb-1 text-center">Total
                                                    Cost</span>
                                                <span class="text-white font-mono font-bold"
                                                    id="calc-break-social-total">-</span>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- 3. Criminal Justice -->
                                    <div class="border-t border-slate-700/50 pt-4">
                                        <div class="text-xs text-slate-500 uppercase font-bold mb-2 text-center">Law
                                            Enforcement (Police, Courts, Jail)</div>
                                        <div
                                            class="grid grid-cols-[1fr_auto_1fr_auto_1fr] gap-2 items-center text-base sm:text-lg">
                                            <div class="flex flex-col items-center">
                                                <span
                                                    class="text-slate-500 text-xs uppercase font-bold mb-1 text-center">New
                                                    Problem Gamblers</span>
                                                <span class="text-white font-mono font-bold"
                                                    id="calc-break-crime-victims">-</span>
                                            </div>
                                            <div class="text-slate-500 font-bold mb-3">×</div>
                                            <div class="flex flex-col items-center">
                                                <span
                                                    class="text-slate-500 text-xs uppercase font-bold mb-1 text-center">Cost/Problem
                                                    Gambler</span>
                                                <span class="text-white font-mono font-bold"
                                                    id="calc-break-crime-per">-</span>
                                            </div>
                                            <div class="text-slate-500 font-bold mb-3">=</div>
                                            <div class="flex flex-col items-center">
                                                <span
                                                    class="text-slate-500 text-xs uppercase font-bold mb-1 text-center">Total
                                                    Cost</span>
                                                <span class="text-white font-mono font-bold"
                                                    id="calc-break-crime-total">-</span>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- 4. Civil Legal -->
                                    <div class="border-t border-slate-700/50 pt-4">
                                        <div class="text-xs text-slate-500 uppercase font-bold mb-2 text-center">Civil
                                            Legal (Bankruptcy, Debts)</div>
                                        <div
                                            class="grid grid-cols-[1fr_auto_1fr_auto_1fr] gap-2 items-center text-base sm:text-lg">
                                            <div class="flex flex-col items-center">
                                                <span
                                                    class="text-slate-500 text-xs uppercase font-bold mb-1 text-center">New
                                                    Problem Gamblers</span>
                                                <span class="text-white font-mono font-bold"
                                                    id="calc-break-legal-victims">-</span>
                                            </div>
                                            <div class="text-slate-500 font-bold mb-3">×</div>
                                            <div class="flex flex-col items-center">
                                                <span
                                                    class="text-slate-500 text-xs uppercase font-bold mb-1 text-center">Cost/Problem
                                                    Gambler</span>
                                                <span class="text-white font-mono font-bold"
                                                    id="calc-break-legal-per">-</span>
                                            </div>
                                            <div class="text-slate-500 font-bold mb-3">=</div>
                                            <div class="flex flex-col items-center">
                                                <span
                                                    class="text-slate-500 text-xs uppercase font-bold mb-1 text-center">Total
                                                    Cost</span>
                                                <span class="text-white font-mono font-bold"
                                                    id="calc-break-legal-total">-</span>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- 5a. Abused Dollars -->
                                    <div class="border-t border-slate-700/50 pt-4">
                                        <div class="text-xs text-slate-500 uppercase font-bold mb-2 text-center">Abused
                                            Dollars (Family Theft, Bad Debt)</div>
                                        <div
                                            class="grid grid-cols-[1fr_auto_1fr_auto_1fr] gap-2 items-center text-base sm:text-lg">
                                            <div class="flex flex-col items-center">
                                                <span
                                                    class="text-slate-500 text-xs uppercase font-bold mb-1 text-center">New
                                                    Problem Gamblers</span>
                                                <span class="text-white font-mono font-bold"
                                                    id="calc-break-abused-victims">-</span>
                                            </div>
                                            <div class="text-slate-500 font-bold mb-3">×</div>
                                            <div class="flex flex-col items-center">
                                                <span
                                                    class="text-slate-500 text-xs uppercase font-bold mb-1 text-center">Cost/Problem
                                                    Gambler</span>
                                                <span class="text-white font-mono font-bold"
                                                    id="calc-break-abused-per">-</span>
                                            </div>
                                            <div class="text-slate-500 font-bold mb-3">=</div>
                                            <div class="flex flex-col items-center">
                                                <span
                                                    class="text-slate-500 text-xs uppercase font-bold mb-1 text-center">Total
                                                    Cost</span>
                                                <span class="text-white font-mono font-bold"
                                                    id="calc-break-abused-total">-</span>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- 5b. Lost Employment -->
                                    <div class="border-t border-slate-700/50 pt-4">
                                        <div class="text-xs text-slate-500 uppercase font-bold mb-2 text-center">Lost
                                            Employment (Productivity, Jobs)</div>
                                        <div
                                            class="grid grid-cols-[1fr_auto_1fr_auto_1fr] gap-2 items-center text-base sm:text-lg">
                                            <div class="flex flex-col items-center">
                                                <span
                                                    class="text-slate-500 text-xs uppercase font-bold mb-1 text-center">New
                                                    Problem Gamblers</span>
                                                <span class="text-white font-mono font-bold"
                                                    id="calc-break-employment-victims">-</span>
                                            </div>
                                            <div class="text-slate-500 font-bold mb-3">×</div>
                                            <div class="flex flex-col items-center">
                                                <span
                                                    class="text-slate-500 text-xs uppercase font-bold mb-1 text-center">Cost/Problem
                                                    Gambler</span>
                                                <span class="text-white font-mono font-bold"
                                                    id="calc-break-employment-per">-</span>
                                            </div>
                                            <div class="text-slate-500 font-bold mb-3">=</div>
                                            <div class="flex flex-col items-center">
                                                <span
                                                    class="text-slate-500 text-xs uppercase font-bold mb-1 text-center">Total
                                                    Cost</span>
                                                <span class="text-white font-mono font-bold"
                                                    id="calc-break-employment-total">-</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Total Line -->
                                <div class="mt-6 pt-4 border-t-2 border-slate-600">
                                    <div
                                        class="grid grid-cols-[1fr_auto_1fr_auto_1fr] gap-2 items-center text-lg sm:text-xl">
                                        <div class="flex flex-col items-center">
                                            <span
                                                class="text-slate-500 text-xs uppercase font-bold mb-1 text-center">Total
                                                Gamblers</span>
                                            <span class="text-white font-mono font-bold"
                                                id="calc-break-total-victims">-</span>
                                        </div>
                                        <div class="text-slate-500 font-bold mb-3">×</div>
                                        <div class="flex flex-col items-center">
                                            <span
                                                class="text-slate-500 text-xs uppercase font-bold mb-1 text-center">Total
                                                Cost/Problem Gambler</span>
                                            <span class="text-white font-mono font-bold"
                                                id="calc-total-cost-per">-</span>
                                        </div>
                                        <div class="text-slate-500 font-bold mb-3">=</div>
                                        <div class="flex flex-col items-center">
                                            <span
                                                class="text-slate-500 text-xs uppercase font-bold mb-1 text-center">Total
                                                Annual Social Cost</span>
                                            <span class="text-white font-mono font-bold"
                                                id="calc-total-cost-combined">-</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- County Selection -->


            </div>
        </div>

        <!-- Results Card -->
        <div class="space-y-6">
            <!-- Results Card -->
            <div class="space-y-6">
                <div
                    class="bg-slate-800 rounded-3xl p-4 sm:p-8 border border-slate-700 shadow-2xl relative overflow-hidden flex flex-col justify-center">
                    <div class="absolute top-0 right-0 -mt-10 -mr-10 w-40 h-40 bg-red-500/10 rounded-full blur-3xl">
                    </div>

                    <h3 class="text-xl font-bold text-slate-300 dark:text-white mb-2" id="deficit-title">
                        <span class="material-symbols-outlined text-blue-500">calculate</span>
                        Deficit Calculation
                    </h3>



                    <!-- Split Balance Sheet -->
                    <div class="relative z-10 bg-slate-900/50 rounded-2xl p-6 border border-slate-600 mb-6 font-sans">
                        <div class="text-sm text-slate-200 uppercase tracking-widest font-bold mb-2 text-center">
                            Net Economic Impact
                        </div>

                        <p class="text-sm text-slate-400 leading-relaxed mb-6 px-4 text-left">
                            Tax revenue is allocated based on a tiered prioritization model. The <span
                                class="text-purple-400 font-bold">Humanitarian Fund</span> exclusively targets Public
                            Health liabilities (addiction and mental health). The <span
                                class="text-blue-400 font-bold">General Fund</span> is distributed pro-rata among Law
                            Enforcement, Social Services, and Civil Legal based on their relative share of the total
                            public sector burden. <span class="text-orange-400 font-bold">Private sector</span> economic
                            losses (Abused Dollars and Lost Employment) receive zero direct tax revenue offset in this
                            analysis.
                        </p>

                        <div
                            class="grid grid-cols-4 gap-2 text-sm uppercase text-slate-500 font-bold mb-2 px-2 border-b border-slate-700 pb-2">
                            <div class="col-span-1">Group</div>
                            <div class="col-span-1 text-right">Revenue</div>
                            <div class="col-span-1 text-right">Cost</div>
                            <div class="col-span-1 text-right">Balance</div>
                        </div>

                        <div class="space-y-4">
                            <!-- 1a. Public Health (Humanitarian) -->
                            <div
                                class="grid grid-cols-4 gap-2 items-center text-xs sm:text-sm border-t border-slate-700/50 pt-2">
                                <div class="flex items-center gap-1">
                                    <span class="font-bold text-purple-400">Public Health (Humanitarian)</span>
                                    <div class="group relative flex items-center">
                                        <span
                                            class="material-symbols-outlined text-slate-400 text-[14px] cursor-help hover:text-purple-400 transition-colors">info</span>
                                        <div
                                            class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-48 p-3 bg-slate-900 dark:bg-slate-800 text-white text-xs rounded-lg shadow-xl border border-slate-700 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-50 font-normal">
                                            Addiction treatment, counseling, and prevention programs funded specifically
                                            by the Humanitarian Fund allocation.
                                            <div
                                                class="absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-slate-900 dark:border-t-slate-800">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="text-right text-emerald-400 font-mono" id="bal-health-human-rev">-</div>
                                <div class="text-right text-red-400 font-mono" id="bal-health-human-cost">-</div>
                                <div class="text-right text-red-400 font-mono" id="bal-health-human-net">-</div>
                            </div>

                            <!-- 1b. Public Health (Taxpayer) -->
                            <div
                                class="grid grid-cols-4 gap-2 items-center text-xs sm:text-sm border-t border-slate-700/50 pt-2">
                                <div class="flex items-center gap-1">
                                    <span class="font-bold text-purple-400">Public Health (Taxpayer)</span>
                                    <div class="group relative flex items-center">
                                        <span
                                            class="material-symbols-outlined text-slate-400 text-[14px] cursor-help hover:text-purple-400 transition-colors">info</span>
                                        <div
                                            class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-48 p-3 bg-slate-900 dark:bg-slate-800 text-white text-xs rounded-lg shadow-xl border border-slate-700 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-50 font-normal">
                                            Excess public health costs (emergency services, uninsured care) falling on
                                            the general taxpayer after Humanitarian funds are exhausted.
                                            <div
                                                class="absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-slate-900 dark:border-t-slate-800">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="text-right text-emerald-400 font-mono" id="bal-health-tax-rev">-</div>
                                <div class="text-right text-red-400 font-mono" id="bal-health-tax-cost">-</div>
                                <div class="text-right text-red-400 font-mono" id="bal-health-tax-net">-</div>
                            </div>

                            <!-- Public Health Subtotal -->
                            <div
                                class="grid grid-cols-4 gap-2 items-center text-xs sm:text-sm border-t border-slate-600 bg-slate-800/30 py-2 font-bold">
                                <div class="font-bold text-purple-400 pl-2">Subtotal: Public Health</div>
                                <div class="text-right text-emerald-400 font-mono" id="bal-health-sub-rev">-</div>
                                <div class="text-right text-red-400 font-mono" id="bal-health-sub-cost">-</div>
                                <div class="text-right text-red-400 font-mono" id="bal-health-sub-net">-</div>
                            </div>

                            <!-- 2. Law Enforcement -->
                            <div
                                class="grid grid-cols-4 gap-2 items-center text-xs sm:text-sm border-t border-slate-700/50 pt-2">
                                <div class="flex items-center gap-1">
                                    <span class="font-bold text-blue-400">Law Enforcement</span>
                                    <div class="group relative flex items-center">
                                        <span
                                            class="material-symbols-outlined text-slate-400 text-[14px] cursor-help hover:text-blue-400 transition-colors">info</span>
                                        <div
                                            class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-48 p-3 bg-slate-900 dark:bg-slate-800 text-white text-xs rounded-lg shadow-xl border border-slate-700 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-50 font-normal">
                                            Police response, investigations, and incarceration costs related to
                                            gambling-related crimes (theft, fraud, domestic disturbances).
                                            <div
                                                class="absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-slate-900 dark:border-t-slate-800">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="text-right text-emerald-400 font-mono" id="bal-crime-rev">-</div>
                                <div class="text-right text-red-400 font-mono" id="bal-crime-cost">-</div>
                                <div class="text-right text-red-400 font-mono" id="bal-crime-net">-</div>
                            </div>

                            <!-- 3. Social Services -->
                            <div
                                class="grid grid-cols-4 gap-2 items-center text-xs sm:text-sm border-t border-slate-700/50 pt-2">
                                <div class="flex items-center gap-1">
                                    <span class="font-bold text-blue-400">Social Services</span>
                                    <div class="group relative flex items-center">
                                        <span
                                            class="material-symbols-outlined text-slate-400 text-[14px] cursor-help hover:text-blue-400 transition-colors">info</span>
                                        <div
                                            class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-48 p-3 bg-slate-900 dark:bg-slate-800 text-white text-xs rounded-lg shadow-xl border border-slate-700 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-50 font-normal">
                                            Unemployment benefits, welfare support, and child protective services for
                                            families destabilized by gambling addiction.
                                            <div
                                                class="absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-slate-900 dark:border-t-slate-800">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="text-right text-emerald-400 font-mono" id="bal-social-rev">-</div>
                                <div class="text-right text-red-400 font-mono" id="bal-social-cost">-</div>
                                <div class="text-right text-red-400 font-mono" id="bal-social-net">-</div>
                            </div>

                            <!-- 4. Civil Legal -->
                            <div
                                class="grid grid-cols-4 gap-2 items-center text-xs sm:text-sm border-t border-slate-700/50 pt-2">
                                <div class="flex items-center gap-1">
                                    <span class="font-bold text-blue-400">Civil Legal</span>
                                    <div class="group relative flex items-center">
                                        <span
                                            class="material-symbols-outlined text-slate-400 text-[14px] cursor-help hover:text-blue-400 transition-colors">info</span>
                                        <div
                                            class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-48 p-3 bg-slate-900 dark:bg-slate-800 text-white text-xs rounded-lg shadow-xl border border-slate-700 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-50 font-normal">
                                            Court costs for bankruptcy proceedings, divorce filings, and civil lawsuits
                                            associated with gambling debts.
                                            <div
                                                class="absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-slate-900 dark:border-t-slate-800">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="text-right text-emerald-400 font-mono" id="bal-legal-rev">-</div>
                                <div class="text-right text-red-400 font-mono" id="bal-legal-cost">-</div>
                                <div class="text-right text-red-400 font-mono" id="bal-legal-net">-</div>
                            </div>

                            <!-- Subtotal: General Taxpayer Services -->
                            <div
                                class="grid grid-cols-4 gap-2 items-center text-xs sm:text-sm border-t border-slate-600 bg-slate-800/30 py-2 font-bold">
                                <div class="font-bold text-blue-400 pl-2">Subtotal: General Taxpayer Services</div>
                                <div class="text-right text-emerald-400 font-mono" id="bal-gen-sub-rev">-</div>
                                <div class="text-right text-red-400 font-mono" id="bal-gen-sub-cost">-</div>
                                <div class="text-right text-red-400 font-mono" id="bal-gen-sub-net">-</div>
                            </div>

                            <!-- Subtotal: Total Public Burden -->
                            <div
                                class="grid grid-cols-4 gap-2 items-center text-xs sm:text-sm border-t-2 border-slate-500 bg-slate-800/50 py-2 font-black">
                                <div
                                    class="font-black text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-blue-400 pl-2 uppercase tracking-wide text-[10px] sm:text-xs">
                                    Subtotal: Public Sector Impact</div>
                                <div class="text-right text-emerald-400 font-mono" id="bal-public-sub-rev">-</div>
                                <div class="text-right text-red-400 font-mono" id="bal-public-sub-cost">-</div>
                                <div class="text-right text-red-400 font-mono" id="bal-public-sub-net">-</div>
                            </div>

                            <!-- 5a. Abused Dollars -->
                            <div
                                class="grid grid-cols-4 gap-2 items-center text-xs sm:text-sm border-t border-slate-700/50 pt-2">
                                <div class="flex items-center gap-1">
                                    <span class="font-bold text-orange-400">Abused Dollars</span>
                                    <div class="group relative flex items-center">
                                        <span
                                            class="material-symbols-outlined text-slate-400 text-[14px] cursor-help hover:text-orange-400 transition-colors">info</span>
                                        <div
                                            class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-48 p-3 bg-slate-900 dark:bg-slate-800 text-white text-xs rounded-lg shadow-xl border border-slate-700 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-50 font-normal">
                                            Direct financial loss to families, including depleted savings, 'borrowed'
                                            funds from relatives, and bad debts.
                                            <div
                                                class="absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-slate-900 dark:border-t-slate-800">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="text-right text-slate-600 font-mono" id="bal-abused-rev">$0</div>
                                <div class="text-right text-red-400 font-mono" id="bal-abused-cost">-</div>
                                <div class="text-right text-red-400 font-mono" id="bal-abused-net">-</div>
                            </div>

                            <!-- 5b. Lost Employment -->
                            <div
                                class="grid grid-cols-4 gap-2 items-center text-xs sm:text-sm border-t border-slate-700/50 pt-2">
                                <div class="flex items-center gap-1">
                                    <span class="font-bold text-orange-400">Lost Employment</span>
                                    <div class="group relative flex items-center">
                                        <span
                                            class="material-symbols-outlined text-slate-400 text-[14px] cursor-help hover:text-orange-400 transition-colors">info</span>
                                        <div
                                            class="absolute bottom-full left-1/2 -translate-x-1/2 mb-2 w-48 p-3 bg-slate-900 dark:bg-slate-800 text-white text-xs rounded-lg shadow-xl border border-slate-700 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-50 font-normal">
                                            Productivity losses for local businesses due to employee absenteeism,
                                            distraction, and turnover related to gambling.
                                            <div
                                                class="absolute top-full left-1/2 -translate-x-1/2 border-4 border-transparent border-t-slate-900 dark:border-t-slate-800">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="text-right text-slate-600 font-mono" id="bal-employment-rev">$0</div>
                                <div class="text-right text-red-400 font-mono" id="bal-employment-cost">-</div>
                                <div class="text-right text-red-400 font-mono" id="bal-employment-net">-</div>
                            </div>

                            <!-- Subtotal: Private Sector Impact -->
                            <div
                                class="grid grid-cols-4 gap-2 items-center text-xs sm:text-sm border-t-2 border-slate-500 bg-slate-800/50 py-2 font-black">
                                <div
                                    class="font-black text-orange-400 pl-2 uppercase tracking-wide text-[10px] sm:text-xs">
                                    Subtotal: Private Sector Impact</div>
                                <div class="text-right text-slate-600 font-mono" id="bal-econ-sub-rev">$0</div>
                                <div class="text-right text-red-400 font-mono" id="bal-econ-sub-cost">-</div>
                                <div class="text-right text-red-400 font-mono" id="bal-econ-sub-net">-</div>
                            </div>

                            <!-- TOTAL NET IMPACT -->
                            <div
                                class="grid grid-cols-4 gap-2 items-center text-xs sm:text-sm border-t-2 border-slate-500 pt-3 mt-2 bg-slate-800/50 -mx-2 px-2 py-2 rounded-lg">
                                <div class="font-black text-white uppercase tracking-wider text-xs sm:text-sm">Total Net
                                    Economic Impact</div>
                                <div class="text-right text-emerald-400 font-bold font-mono" id="bal-total-rev">-</div>
                                <div class="text-right text-red-400 font-mono" id="bal-total-cost">-</div>
                                <div class="text-right text-red-400 font-mono" id="bal-total-net">-</div>
                            </div>
                        </div>

                        <!-- Progress Bar -->
                        <div class="relative z-10 mt-8 mb-4">
                            <div class="flex justify-between text-base font-bold mb-2">
                                <span class="text-emerald-500">Revenue Covered</span>
                                <span class="text-red-500">Uncovered Cost</span>
                            </div>
                            <div class="w-full bg-red-500/60 rounded-full h-4 overflow-hidden border border-slate-700">
                                <div class="bg-emerald-500 h-full transition-all duration-500" style="width: 35%"
                                    id="res-bar"></div>
                            </div>
                            <p class="mt-4 text-center text-base text-slate-300 italic" id="res-footer">
                                Tax Revenue covers only <strong class="text-white text-lg">35%</strong> of social costs.
                            </p>
                        </div>

                        <!-- Programmatic Analysis & Disclaimer -->
                        <div class="mt-6 pt-4 border-t border-slate-700">
                            <div class="rounded-lg p-4 mb-4">
                                <h5
                                    class="text-white font-bold uppercase tracking-wider mb-2 flex items-center justify-center gap-2">
                                    <span class="material-symbols-outlined">analytics</span>
                                    SaveFW's Economic Impact Analysis
                                </h5>
                                <p class="text-slate-300 leading-relaxed" id="analysis-text">
                                    <!-- Populated by JS -->
                                </p>
                            </div>
                        </div>
                    </div>


<script>
window.initEconomicCalculator = function() {
                            const countyData = [
                                { id: "001", name: "Adams", pop: 35809 },
                                { id: "003", name: "Allen", pop: 385410 },
                                { id: "005", name: "Bartholomew", pop: 82208 },
                                { id: "007", name: "Benton", pop: 8719 },
                                { id: "009", name: "Blackford", pop: 12112 },
                                { id: "011", name: "Boone", pop: 70812 },
                                { id: "013", name: "Brown", pop: 15475 },
                                { id: "015", name: "Carroll", pop: 20306 },
                                { id: "017", name: "Cass", pop: 37870 },
                                { id: "019", name: "Clark", pop: 121093 },
                                { id: "021", name: "Clay", pop: 26466 },
                                { id: "023", name: "Clinton", pop: 33190 },
                                { id: "025", name: "Crawford", pop: 10526 },
                                { id: "027", name: "Daviess", pop: 33381 },
                                { id: "029", name: "Dearborn", pop: 50679 },
                                { id: "031", name: "Decatur", pop: 26472 },
                                { id: "033", name: "DeKalb", pop: 43265 },
                                { id: "035", name: "Delaware", pop: 111903 },
                                { id: "037", name: "Dubois", pop: 43637 },
                                { id: "039", name: "Elkhart", pop: 207047 },
                                { id: "041", name: "Fayette", pop: 23398 },
                                { id: "043", name: "Floyd", pop: 80484 },
                                { id: "045", name: "Fountain", pop: 16479 },
                                { id: "047", name: "Franklin", pop: 22785 },
                                { id: "049", name: "Fulton", pop: 20480 },
                                { id: "051", name: "Gibson", pop: 33011 },
                                { id: "053", name: "Grant", pop: 66674 },
                                { id: "055", name: "Greene", pop: 30803 },
                                { id: "057", name: "Hamilton", pop: 347467 },
                                { id: "059", name: "Hancock", pop: 79840 },
                                { id: "061", name: "Harrison", pop: 39654 },
                                { id: "063", name: "Hendricks", pop: 174788 },
                                { id: "065", name: "Henry", pop: 48914 },
                                { id: "067", name: "Howard", pop: 82544 },
                                { id: "069", name: "Huntington", pop: 36662 },
                                { id: "071", name: "Jackson", pop: 46428 },
                                { id: "073", name: "Jasper", pop: 32918 },
                                { id: "075", name: "Jay", pop: 20478 },
                                { id: "077", name: "Jefferson", pop: 33147 },
                                { id: "079", name: "Jennings", pop: 27613 },
                                { id: "081", name: "Johnson", pop: 161765 },
                                { id: "083", name: "Knox", pop: 36282 },
                                { id: "085", name: "Kosciusko", pop: 80240 },
                                { id: "087", name: "LaGrange", pop: 40446 },
                                { id: "089", name: "Lake", pop: 498700 },
                                { id: "091", name: "LaPorte", pop: 112417 },
                                { id: "093", name: "Lawrence", pop: 45011 },
                                { id: "095", name: "Madison", pop: 130129 },
                                { id: "097", name: "Marion", pop: 977203 },
                                { id: "099", name: "Marshall", pop: 46095 },
                                { id: "101", name: "Martin", pop: 9812 },
                                { id: "103", name: "Miami", pop: 35962 },
                                { id: "105", name: "Monroe", pop: 139718 },
                                { id: "107", name: "Montgomery", pop: 37936 },
                                { id: "109", name: "Morgan", pop: 71780 },
                                { id: "111", name: "Newton", pop: 13830 },
                                { id: "113", name: "Noble", pop: 47457 },
                                { id: "115", name: "Ohio", pop: 5940 },
                                { id: "117", name: "Orange", pop: 19867 },
                                { id: "119", name: "Owen", pop: 21321 },
                                { id: "121", name: "Parke", pop: 16156 },
                                { id: "123", name: "Perry", pop: 19170 },
                                { id: "125", name: "Pike", pop: 12250 },
                                { id: "127", name: "Porter", pop: 173215 },
                                { id: "129", name: "Posey", pop: 25222 },
                                { id: "131", name: "Pulaski", pop: 12514 },
                                { id: "133", name: "Putnam", pop: 36726 },
                                { id: "135", name: "Randolph", pop: 24502 },
                                { id: "137", name: "Ripley", pop: 28995 },
                                { id: "139", name: "Rush", pop: 16752 },
                                { id: "141", name: "St. Joseph", pop: 272912 },
                                { id: "143", name: "Scott", pop: 24384 },
                                { id: "145", name: "Shelby", pop: 45055 },
                                { id: "147", name: "Spencer", pop: 19810 },
                                { id: "149", name: "Starke", pop: 23371 },
                                { id: "151", name: "Steuben", pop: 34435 },
                                { id: "153", name: "Sullivan", pop: 20817 },
                                { id: "155", name: "Switzerland", pop: 9737 },
                                { id: "157", name: "Tippecanoe", pop: 186251 },
                                { id: "159", name: "Tipton", pop: 15359 },
                                { id: "161", name: "Union", pop: 7087 },
                                { id: "163", name: "Vanderburgh", pop: 180136 },
                                { id: "165", name: "Vermillion", pop: 15439 },
                                { id: "167", name: "Vigo", pop: 106153 },
                                { id: "169", name: "Wabash", pop: 30976 },
                                { id: "171", name: "Warren", pop: 8440 },
                                { id: "173", name: "Warrick", pop: 63898 },
                                { id: "175", name: "Washington", pop: 28182 },
                                { id: "177", name: "Wayne", pop: 66553 },
                                { id: "179", name: "Wells", pop: 28180 },
                                { id: "181", name: "White", pop: 24688 },
                                { id: "183", name: "Whitley", pop: 34191 }
                            ];

                            let currentPop = 385410; // Default Allen

                            const els = {
                                inCounty: document.getElementById('input-county'),
                                inRevenue: document.getElementById('input-revenue'),
                                inAGR: document.getElementById('input-agr'),
                                inRate: document.getElementById('input-rate'),
                                inAllocation: document.getElementById('input-allocation'), // New

                                // New Inputs
                                inCostCrime: document.getElementById('input-cost-crime'),
                                inCostBusiness: document.getElementById('input-cost-business'),
                                inCostBankruptcy: document.getElementById('input-cost-bankruptcy'),
                                inCostIllness: document.getElementById('input-cost-illness'),
                                inCostServices: document.getElementById('input-cost-services'),
                                inCostAbused: document.getElementById('input-cost-abused'),

                                // Allocation Visuals
                                allocBarHuman: document.getElementById('alloc-bar-human'),
                                allocBarTaxpayer: document.getElementById('alloc-bar-taxpayer'),
                                allocTextHuman: document.getElementById('alloc-text-human'),
                                allocTextTaxpayer: document.getElementById('alloc-text-taxpayer'),

                                valRevenue: document.getElementById('val-revenue'),
                                valAGR: document.getElementById('val-agr'),
                                valEffectiveRate: document.getElementById('val-effective-rate'),
                                valRate: document.getElementById('val-rate'),

                                // New Value Displays
                                valCostTotal: document.getElementById('val-cost-total'),
                                valCostCrime: document.getElementById('val-cost-crime'),
                                valCostBusiness: document.getElementById('val-cost-business'),
                                valCostBankruptcy: document.getElementById('val-cost-bankruptcy'),
                                valCostIllness: document.getElementById('val-cost-illness'),
                                valCostServices: document.getElementById('val-cost-services'),
                                valCostAbused: document.getElementById('val-cost-abused'),
                                resVictims: document.getElementById('res-victims'),
                                resTotalCost: document.getElementById('res-total-cost'),
                                resDeficit: document.getElementById('res-deficit'),
                                resResultLabel: document.getElementById('res-result-label'),
                                resEqRevenue: document.getElementById('res-eq-revenue'),
                                resEqCost: document.getElementById('res-eq-cost'),
                                resBar: document.getElementById('res-bar'),
                                resFooter: document.getElementById('res-footer'),
                                resBar: document.getElementById('res-bar'),
                                resFooter: document.getElementById('res-footer'),
                                deficitTitle: document.getElementById('deficit-title'),

                                // Calculation Breakdown 1
                                calcPop: document.getElementById('calc-pop'),
                                calcRate: document.getElementById('calc-rate'),
                                calcResult: document.getElementById('calc-result'),

                                // New Calculation Breakdowns
                                calcAGR: document.getElementById('calc-agr'),
                                calcTaxRate: document.getElementById('calc-tax-rate'),
                                calcTaxTotal: document.getElementById('calc-tax-total'),

                                // Split Allocation Elements
                                calcRevTotalH: document.getElementById('calc-rev-total-h'),
                                calcAllocPctH: document.getElementById('calc-alloc-pct-h'),
                                calcAllocHumanVal: document.getElementById('calc-alloc-human-val'),

                                calcRevTotalG: document.getElementById('calc-rev-total-g'),
                                calcAllocPctG: document.getElementById('calc-alloc-pct-g'),
                                calcAllocGenVal: document.getElementById('calc-alloc-gen-val'),

                                // Detailed Breakdown Elements (New)
                                calcBreakHealthVictims: document.getElementById('calc-break-health-victims'),
                                calcBreakSocialVictims: document.getElementById('calc-break-social-victims'),
                                calcBreakCrimeVictims: document.getElementById('calc-break-crime-victims'),
                                calcBreakLegalVictims: document.getElementById('calc-break-legal-victims'),
                                calcBreakEconVictims: document.getElementById('calc-break-econ-victims'),
                                calcBreakTotalVictims: document.getElementById('calc-break-total-victims')
                            };

                            // Init Counties
                            function initCounties()
                            {
                                // 1. Populate Native Select (Hidden)
                                els.inCounty.innerHTML = ''; // Clear
                                countyData.forEach(c =>
                                {
                                    const opt = document.createElement('option');
                                    opt.value = c.pop;
                                    opt.textContent = `${c.name} (${c.pop.toLocaleString()})`;
                                    if (c.name === 'Allen') opt.selected = true;
                                    els.inCounty.appendChild(opt);
                                });

                                // 2. Init Custom UI
                                renderCustomOptions(countyData); // Initial Render
                            }

                            // Render Custom Options Function
                            function renderCustomOptions(data)
                            {
                                const container = document.getElementById('county-options');
                                container.innerHTML = '';

                                if (data.length === 0)
                                {
                                    container.innerHTML = `<div class="p-4 text-center text-sm text-slate-400">No counties found.</div>`;
                                    return;
                                }

                                data.forEach(c =>
                                {
                                    const div = document.createElement('div');
                                    div.className = "px-4 py-3 text-sm text-slate-700 dark:text-slate-300 hover:bg-blue-50 dark:hover:bg-blue-900/20 hover:text-blue-600 dark:hover:text-blue-400 cursor-pointer transition-colors flex items-center justify-between group";
                                    div.innerHTML = `
                                        <span class="font-medium">${c.name}</span>
                                        <span class="text-xs text-white font-mono bg-[#0f172a] dark:bg-[#0f172a] px-2 py-0.5 rounded transition-colors">${c.pop.toLocaleString()}</span>
                                    `;
                                    div.onclick = () =>
                                    {
                                        selectCounty(c.name, c.pop);
                                    };
                                    container.appendChild(div);
                                });
                            }

                            // Select County Helper
                            function selectCounty(name, pop)
                            {
                                // 1. Update Native Select
                                els.inCounty.value = pop;

                                // 2. Update Display
                                document.getElementById('county-display').textContent = `${name} (${pop.toLocaleString()})`;

                                // 3. Trigger Calculation
                                els.inCounty.dispatchEvent(new Event('change'));

                                // 4. Close Menu
                                toggleMenu(false);
                            }

                            // Menu Logic
                            const trigger = document.getElementById('county-trigger');
                            const menu = document.getElementById('county-menu');
                            const searchInput = document.getElementById('county-search');
                            let isOpen = false;

                            function toggleMenu(show)
                            {
                                isOpen = show;
                                if (show)
                                {
                                    menu.classList.remove('hidden');
                                    // Small delay to allow display:block to apply before transition
                                    requestAnimationFrame(() =>
                                    {
                                        menu.classList.remove('opacity-0', 'scale-95');
                                        menu.classList.add('opacity-100', 'scale-100');
                                        searchInput.focus();
                                    });
                                } else
                                {
                                    menu.classList.remove('opacity-100', 'scale-100');
                                    menu.classList.add('opacity-0', 'scale-95');
                                    setTimeout(() =>
                                    {
                                        menu.classList.add('hidden');
                                        searchInput.value = ''; // Reset search
                                        renderCustomOptions(countyData); // Reset list
                                    }, 200); // Match duration
                                }
                            }

                            trigger.onclick = (e) =>
                            {
                                e.preventDefault(); // Prevent form submission if in form
                                toggleMenu(!isOpen);
                            };

                            // Search Logic
                            searchInput.oninput = (e) =>
                            {
                                const term = e.target.value.toLowerCase();
                                const filtered = countyData.filter(c => c.name.toLowerCase().includes(term));
                                renderCustomOptions(filtered);
                            };

                            // Click Outside to Close
                            document.addEventListener('click', (e) =>
                            {
                                if (!trigger.contains(e.target) && !menu.contains(e.target) && isOpen)
                                {
                                    toggleMenu(false);
                                }
                            });

                            function calculateTax(agr)
                            {
                                // Step A: Supplemental Tax
                                let supplementalTax = agr * 0.035;

                                // Step B: Determine Base Rate
                                let baseRate = (agr < 75000000) ? 0.05 : 0.15;

                                // Step C: Free Play Deduction
                                let taxableAGR = Math.max(0, agr - 7000000);
                                let freePlayDeduction = (agr > 7000000) ? 7000000 : agr;

                                // Step D: Apply Brackets to Taxable_AGR
                                let bracketTax = 0;
                                let breakdown = [];

                                // Format helper
                                const fmtM = (v) => '$' + (v / 1000000).toFixed(1) + 'MM';
                                const fmt = (v) => '$' + v.toLocaleString(undefined, { maximumFractionDigits: 0 });

                                breakdown.push({ label: "Adjusted Gross Revenue (AGR)", val: fmt(agr), note: "", type: 'header' });
                                breakdown.push({ label: "Supplemental Tax (3.5%)", val: fmt(supplementalTax), note: "Off the top", type: 'add' });
                                breakdown.push({ label: "Free Play Deduction", val: fmt(freePlayDeduction), note: "First $7MM Exempt", type: 'info' });
                                breakdown.push({ label: "Taxable AGR", val: fmt(taxableAGR), note: "AGR - $7MM", type: 'sub-header' });

                                let remaining = taxableAGR;

                                // Tier 1: First $25M
                                let tier1Amt = Math.min(Math.max(0, remaining), 25000000);
                                let t1Tax = tier1Amt * baseRate;
                                bracketTax += t1Tax;
                                remaining -= tier1Amt;
                                breakdown.push({ label: `Tier 1 ($0-$25MM) @@ ${(baseRate * 100).toFixed(0)}%`, val: fmt(t1Tax), note: `on ${fmtM(tier1Amt)}`, type: 'add' });

                                // Tier 2: Next $25M ($25M-$50M) at 20%
                                let tier2Amt = Math.min(Math.max(0, remaining), 25000000);
                                let t2Tax = tier2Amt * 0.20;
                                bracketTax += t2Tax;
                                remaining -= tier2Amt;
                                breakdown.push({ label: "Tier 2 ($25MM-$50MM) @@ 20%", val: fmt(t2Tax), note: `on ${fmtM(tier2Amt)}`, type: 'add' });

                                // Tier 3: Next $25M ($50M-$75M) at 25%
                                let tier3Amt = Math.min(Math.max(0, remaining), 25000000);
                                let t3Tax = tier3Amt * 0.25;
                                bracketTax += t3Tax;
                                remaining -= tier3Amt;
                                breakdown.push({ label: "Tier 3 ($50MM-$75MM) @@ 25%", val: fmt(t3Tax), note: `on ${fmtM(tier3Amt)}`, type: 'add' });

                                // Tier 4: Next $75M ($75M-$150M) at 30%
                                let tier4Amt = Math.min(Math.max(0, remaining), 75000000);
                                let t4Tax = tier4Amt * 0.30;
                                bracketTax += t4Tax;
                                remaining -= tier4Amt;
                                breakdown.push({ label: "Tier 4 ($75MM-$150MM) @@ 30%", val: fmt(t4Tax), note: `on ${fmtM(tier4Amt)}`, type: 'add' });

                                // Tier 5: Next $450M ($150M-$600M) at 35%
                                let tier5Amt = Math.min(Math.max(0, remaining), 450000000);
                                let t5Tax = tier5Amt * 0.35;
                                bracketTax += t5Tax;
                                remaining -= tier5Amt;
                                breakdown.push({ label: "Tier 5 ($150MM-$600MM) @@ 35%", val: fmt(t5Tax), note: `on ${fmtM(tier5Amt)}`, type: 'add' });

                                // Tier 6: Over $600M at 40%
                                let t6Tax = Math.max(0, remaining) * 0.40;
                                bracketTax += t6Tax;
                                breakdown.push({ label: "Tier 6 (Over $600MM) @@ 40%", val: fmt(t6Tax), note: `on ${fmtM(Math.max(0, remaining))}`, type: 'add' });

                                let totalTax = supplementalTax + bracketTax;
                                breakdown.push({ label: "TOTAL ESTIMATED TAX", val: fmt(totalTax), note: "", type: 'total' });

                                // Effective Rate
                                const effRate = agr > 0 ? (totalTax / agr) * 100 : 0;
                                breakdown.push({ label: "Effective Tax Rate of AGR", val: effRate.toFixed(2) + '%', note: "", type: 'eff-rate' });

                                // Step E: Total
                                return { total: totalTax, breakdown: breakdown };
                            }

                            function calculateAGRFromTax(targetTax)
                            {
                                let low = 0;
                                let high = 2000000000; // 2B
                                let mid = 0;
                                let iterations = 0;

                                while (low <= high && iterations < 100)
                                {
                                    mid = (low + high) / 2;
                                    const res = calculateTax(mid);
                                    const tax = res.total;

                                    if (Math.abs(tax - targetTax) < 100)
                                    { // Precision $100
                                        return mid;
                                    }

                                    if (tax < targetTax)
                                    {
                                        low = mid;
                                    } else
                                    {
                                        high = mid;
                                    }
                                    iterations++;
                                }
                                return mid;
                            }

                            function calculate(e)
                            {
                                // Update Title
                                const selectedOption = els.inCounty.options[els.inCounty.selectedIndex];
                                const countyName = selectedOption.text.split(' (')[0];
                                els.deficitTitle.innerHTML = `<span class="material-symbols-outlined text-red-500 align-middle mr-2">calculate</span> ${countyName} County Casino Net Economic Impact Analysis`;

                                // 1. Two-Way Binding Logic (AGR vs Revenue)
                                const source = e ? e.target : null;
                                let revenueM = 0;
                                let agrM = 0;
                                let taxResult = null;

                                if (source === els.inAGR)
                                {
                                    // Master: AGR
                                    agrM = parseFloat(els.inAGR.value);
                                    taxResult = calculateTax(agrM * 1000000);
                                    revenueM = taxResult.total / 1000000;

                                    // Update Revenue Slider (Snap disabled for calculated updates)
                                    els.inRevenue.value = revenueM.toFixed(2);
                                    els.inRevenue.dispatchEvent(new Event('slider-update'));
                                } else if (source === els.inRevenue)
                                {
                                    // Master: Revenue
                                    revenueM = parseFloat(els.inRevenue.value);
                                    const targetTax = revenueM * 1000000;
                                    const agr = calculateAGRFromTax(targetTax);
                                    agrM = agr / 1000000;
                                    taxResult = calculateTax(agr); // Recalculate for breakdown

                                    // Update AGR Slider
                                    els.inAGR.value = agrM.toFixed(1);
                                    els.inAGR.dispatchEvent(new Event('slider-update'));
                                } else
                                {
                                    // Init or other inputs: Default to Revenue as Master (e.g. 27.5M)
                                    // If this is init, inRevenue has 27.5.
                                    revenueM = parseFloat(els.inRevenue.value);
                                    const targetTax = revenueM * 1000000;
                                    const agr = calculateAGRFromTax(targetTax);
                                    agrM = agr / 1000000;
                                    taxResult = calculateTax(agr); // Recalculate for breakdown
                                    if (!source)
                                    {
                                        els.inAGR.value = agrM.toFixed(1); // Only update on init
                                        els.inAGR.dispatchEvent(new Event('slider-update'));
                                    }
                                }

                                // Update Displays
                                els.valRevenue.textContent = '$' + revenueM.toFixed(1) + 'MM';
                                els.valAGR.textContent = '$' + agrM.toFixed(1) + 'MM';

                                // RENDER TAX BREAKDOWN
                                const container = document.getElementById('tax-details-container');
                                if (container && taxResult && taxResult.breakdown)
                                {
                                    // Force font-sans on container if not present
                                    container.classList.remove('font-mono');
                                    container.classList.add('font-sans');

                                    container.innerHTML = taxResult.breakdown.map(item =>
                                    {
                                        let colorClass = 'text-slate-400';
                                        if (item.type === 'total') colorClass = 'text-emerald-400 font-bold border-t border-slate-600 pt-2 mt-2';
                                        if (item.type === 'eff-rate') colorClass = 'text-emerald-600 dark:text-emerald-500 font-bold text-sm border-t border-slate-700/50 pt-1 mt-1';
                                        if (item.type === 'add') colorClass = 'text-emerald-500/80 pl-2';
                                        if (item.type === 'header') colorClass = 'text-white font-bold pb-1 border-b border-slate-700 mb-1';
                                        if (item.type === 'sub-header') colorClass = 'text-slate-200 font-semibold mt-2';
                                        if (item.type === 'info') colorClass = 'text-slate-500 italic pl-2';

                                        return `
                                                <div class="flex justify-between items-center ${colorClass}">
                                                    <div class="flex flex-col">
                                                        <span>${item.label}</span>
                                                        ${item.note ? `<span class="text-[10px] opacity-70 font-mono">${item.note}</span>` : ''}
                                                    </div>
                                                    <span class="font-mono">${item.val}</span>
                                                </div>
                                            `;
                                    }).join('');
                                }

                                // Snap Logic & Visual Update
                                const inputs = [
                                    els.inRate, els.inAGR, els.inRevenue, els.inCostCrime, els.inCostBusiness,
                                    els.inCostBankruptcy, els.inCostIllness, els.inCostServices, els.inCostAbused
                                ];

                                inputs.forEach(input =>
                                {
                                    if (!input) return;

                                    // Support multiple defaults for Rate slider
                                    const defs = input.id === 'input-rate' ? [2.3, 3.0, 5.5] : [parseFloat(input.dataset.default)];
                                    let val = parseFloat(input.value);
                                    const min = parseFloat(input.min);
                                    const max = parseFloat(input.max);
                                    const range = max - min;
                                    const threshold = range * 0.015;

                                    let snapped = false;
                                    let snapVal = null;

                                    for (const d of defs)
                                    {
                                        if (Math.abs(val - d) < threshold)
                                        {
                                            snapped = true;
                                            snapVal = d;
                                            break;
                                        }
                                    }

                                    const valDisplayId = input.id.replace('input-', 'val-');
                                    const valDisplay = document.getElementById(valDisplayId);

                                    // Determine active color based on slider type
                                    let activeColor = null;
                                    if (input.id === 'input-rate') activeColor = 'text-orange-500';
                                    else if (input.id === 'input-revenue') activeColor = 'text-emerald-500';
                                    else if (input.id === 'input-agr') activeColor = 'text-emerald-400';

                                    if (snapped) 
                                    {
                                        if (Math.abs(val - snapVal) > 0.001)
                                        {
                                            input.value = snapVal;
                                            val = snapVal;
                                        }

                                        if (valDisplay && activeColor)
                                        {
                                            valDisplay.classList.remove('text-white');
                                            valDisplay.classList.add(activeColor);
                                        }
                                    } else
                                    {
                                        if (valDisplay && activeColor)
                                        {
                                            valDisplay.classList.remove(activeColor);
                                            valDisplay.classList.add('text-white');
                                        }
                                    }

                                    // Update Sibling (Radio or Tick)
                                    if (input.id === 'input-rate')
                                    {
                                        const radios = document.querySelectorAll('input[name="gambling-rate-preset"]');
                                        radios.forEach(r => r.checked = (snapped && parseFloat(r.value) === snapVal));
                                    } else
                                    {
                                        const sibling = input.nextElementSibling;
                                        if (sibling && sibling.type === 'radio')
                                        {
                                            sibling.checked = snapped;
                                        }
                                    }
                                });

                                // NOTE: revenueM is already calculated above
                                const rate = parseFloat(els.inRate.value);

                                // Get costs
                                const cCrime = parseInt(els.inCostCrime.value);
                                const cBusiness = parseInt(els.inCostBusiness.value);
                                const cBankruptcy = parseInt(els.inCostBankruptcy.value);
                                const cIllness = parseInt(els.inCostIllness.value);
                                const cServices = parseInt(els.inCostServices.value);
                                const cAbused = parseInt(els.inCostAbused.value);

                                const costPer = cCrime + cBusiness + cBankruptcy + cIllness + cServices + cAbused;

                                // Update value displays
                                // els.valRevenue.textContent = '$' + revenueM.toFixed(1) + ' M'; // Already updated above
                                els.valRate.textContent = rate.toFixed(1) + '%';

                                els.valCostTotal.textContent = '$' + costPer.toLocaleString();
                                els.valCostCrime.textContent = '$' + cCrime.toLocaleString();
                                els.valCostBusiness.textContent = '$' + cBusiness.toLocaleString();
                                els.valCostBankruptcy.textContent = '$' + cBankruptcy.toLocaleString();
                                els.valCostIllness.textContent = '$' + cIllness.toLocaleString();
                                els.valCostServices.textContent = '$' + cServices.toLocaleString();
                                els.valCostAbused.textContent = '$' + cAbused.toLocaleString();

                                // Logic
                                // Logic
                                currentPop = parseInt(els.inCounty.value);

                                // REFACTORED: We now rely on the Map Logic to calculate true victim count.
                                // However, `calculate` runs when inputs change.
                                // We need to read the `totalVictims` that the Map logic pushed to the DOM,
                                // or re-calculate it if we want to be pure.
                                // Since Map Logic updates the DOM element #total-victims which is NOT in this `els` scope easily,
                                // let's use the value from #calc-result if available, or 0.
                                // BETTER: Read the text content of the global total-victims display.

                                let victims = 0;
                                const tvEl = document.getElementById('total-gamblers');
                                if (tvEl)
                                {
                                    victims = parseInt(tvEl.textContent.replace(/,/g, '')) || 0;
                                }

                                // If victims is 0 (initial load race condition), fallback to simple? 
                                // No, map loads fast.

                                // Calculate Effective Rate for display purposes (This is 'Problem Gambler Growth' rate, distinct from tax rate)
                                let gamblerGrowthRate = 0;
                                if (currentPop > 0) gamblerGrowthRate = (victims / currentPop) * 100;
                                els.calcRate.textContent = gamblerGrowthRate.toFixed(2) + '%';

                                // --- 5-GROUP COST CALCULATIONS ---
                                // 1. Public Health (Humanitarian)
                                const costHealthPer = cIllness;
                                const totalCostHealth = victims * costHealthPer;

                                // 2. Social Services (General)
                                const costSocialPer = cServices;
                                const totalCostSocial = victims * costSocialPer;

                                // 3. Law Enforcement
                                const costCrimePer = cCrime;
                                const totalCostCrime = victims * costCrimePer;

                                // 4. Civil Legal
                                const costLegalPer = cBankruptcy;
                                const totalCostLegal = victims * costLegalPer;

                                // 5. Private Economy (Split)
                                const costAbusedPer = cAbused;
                                const totalCostAbused = victims * costAbusedPer;

                                const costEmploymentPer = cBusiness;
                                const totalCostEmployment = victims * costEmploymentPer;

                                // Aggregate for Total Cost
                                const totalCostEcon = totalCostAbused + totalCostEmployment; // Kept for backward compat with breakdown if needed
                                const costEconPer = costAbusedPer + costEmploymentPer;

                                const totalCost = totalCostHealth + totalCostSocial + totalCostCrime + totalCostLegal + totalCostEcon;
                                const totalCostM = totalCost / 1000000;
                                // --- REVENUE SPLIT ---
                                const totalRevenue = revenueM * 1000000;

                                // Get Allocation %
                                const allocPct = parseInt(els.inAllocation.value);

                                // Update Allocation Bar Visuals
                                els.allocBarHuman.style.width = allocPct + '%';
                                els.allocBarTaxpayer.style.width = (100 - allocPct) + '%';
                                els.allocTextHuman.textContent = allocPct + '%';
                                els.allocTextTaxpayer.textContent = (100 - allocPct) + '%';

                                // Calculate Pools
                                const revHealthPool = totalRevenue * (allocPct / 100);
                                const revGeneralPool = totalRevenue * ((100 - allocPct) / 100);

                                // --- COST COVERAGE LOGIC ---

                                // 1. Humanitarian Fund covers Public Health first
                                let revHealthAllocated = 0;
                                let healthSurplus = 0;
                                let healthUncovered = 0;

                                if (revHealthPool >= totalCostHealth)
                                {
                                    revHealthAllocated = totalCostHealth;
                                    healthSurplus = revHealthPool - totalCostHealth;
                                    healthUncovered = 0;
                                } else
                                {
                                    revHealthAllocated = revHealthPool;
                                    healthSurplus = 0;
                                    healthUncovered = totalCostHealth - revHealthPool;
                                }

                                // 2. General Fund covers remaining burdens (Taxpayer Health + Crime + Social + Legal)
                                // We use a weighted average distribution for the General Fund
                                // UPDATED: General Fund does NOT cover Public Health gaps. Public Health is solely the responsibility of the Humanitarian Fund.
                                const burdenHealth = 0;
                                const burdenCrime = totalCostCrime;
                                const burdenSocial = totalCostSocial;
                                const burdenLegal = totalCostLegal;

                                const totalGeneralBurden = burdenHealth + burdenCrime + burdenSocial + burdenLegal;

                                let revHealthFromGen = 0;
                                let revCrime = 0;
                                let revSocial = 0;
                                let revLegal = 0;

                                if (totalGeneralBurden > 0)
                                {
                                    revHealthFromGen = revGeneralPool * (burdenHealth / totalGeneralBurden);
                                    revCrime = revGeneralPool * (burdenCrime / totalGeneralBurden);
                                    revSocial = revGeneralPool * (burdenSocial / totalGeneralBurden);
                                    revLegal = revGeneralPool * (burdenLegal / totalGeneralBurden);
                                } else
                                {
                                    // If no burden, revenue sits as surplus? 
                                    // For now, it remains unallocated in this logic block, 
                                    // but effectively it's a general surplus.
                                }

                                // Private gets 0
                                const revEcon = 0;

                                // --- BALANCES (NET IMPACT ANALYSIS) ---

                                // Helpers
                                const fmtM = (v) => '$' + (v / 1000000).toFixed(1) + 'MM';
                                const fmt = (v) => '$' + v.toLocaleString(undefined, { maximumFractionDigits: 0 });
                                const fmtDiff = (v) =>
                                {
                                    return (v >= 0 ? '+$' : '-$') + Math.abs(v / 1000000).toFixed(1) + 'MM';
                                };
                                const setTxt = (id, val) => { const el = document.getElementById(id); if (el) el.textContent = val; };
                                const setClass = (id, cls) => { const el = document.getElementById(id); if (el) el.className = cls; };

                                // 1. Detailed Social Cost Breakdown
                                const fmtVictims = victims.toLocaleString();

                                setTxt('calc-break-health-victims', fmtVictims);
                                setTxt('calc-break-health-per', fmt(costHealthPer));
                                setTxt('calc-break-health-total', fmtM(totalCostHealth));

                                setTxt('calc-break-social-victims', fmtVictims);
                                setTxt('calc-break-social-per', fmt(costSocialPer));
                                setTxt('calc-break-social-total', fmtM(totalCostSocial));

                                setTxt('calc-break-crime-victims', fmtVictims);
                                setTxt('calc-break-crime-per', fmt(costCrimePer));
                                setTxt('calc-break-crime-total', fmtM(totalCostCrime));

                                setTxt('calc-break-legal-victims', fmtVictims);
                                setTxt('calc-break-legal-per', fmt(costLegalPer));
                                setTxt('calc-break-legal-total', fmtM(totalCostLegal));

                                setTxt('calc-break-abused-victims', fmtVictims);
                                setTxt('calc-break-abused-per', fmt(costAbusedPer));
                                setTxt('calc-break-abused-total', fmtM(totalCostAbused));

                                setTxt('calc-break-employment-victims', fmtVictims);
                                setTxt('calc-break-employment-per', fmt(costEmploymentPer));
                                setTxt('calc-break-employment-total', fmtM(totalCostEmployment));

                                setTxt('calc-break-total-victims', fmtVictims);
                                setTxt('calc-total-cost-per', fmt(costPer));
                                setTxt('calc-total-cost-combined', fmtM(totalCost));

                                // 2. Net Impact Analysis (Balance Sheet)

                                // 1a. Public Health (Humanitarian)
                                // Revenue: The amount of the pool used + any surplus
                                const humanNet = revHealthPool - revHealthAllocated; // Should be surplus or 0 if deficit
                                // Actually, balance is Revenue - Cost.
                                // Here cost covered is revHealthAllocated.
                                // Wait, the row is "Public Health (Humanitarian)". 
                                // Cost attributed here is the portion covered by Humanitarian fund? Or the full cost?
                                // Standard accounting: 
                                // Row 1: Humanitarian Source. Cost = Amount Covered. Balance = Surplus.
                                // Row 2: Taxpayer Source. Cost = Remaining Amount. Balance = Net.

                                // Let's display: 
                                // Rev: Total Humanitarian Pool
                                // Cost: The portion of Health Cost assigned to this fund (revHealthAllocated)
                                // Balance: Surplus (if any)

                                // Wait, if we split the cost row, we should split the cost value too.
                                // Cost 1: Portion covered by Human Fund.
                                // Cost 2: Portion covered by Tax Fund.

                                // However, the user might want to see the FULL cost against the revenue?
                                // No, splitting rows implies splitting responsibility.

                                setTxt('bal-health-human-rev', fmtM(revHealthPool));
                                setTxt('bal-health-human-cost', fmtM(revHealthAllocated)); // The cost absorbed by this fund
                                setTxt('bal-health-human-net', fmtDiff(healthSurplus)); // Net surplus
                                setClass('bal-health-human-net', `text-right font-bold font-mono ${healthSurplus >= 0 ? 'text-emerald-400' : 'text-red-500'}`);

                                // 1b. Public Health (Taxpayer)
                                // Revenue: Allocation from General Fund
                                // Cost: The Uncovered Health Cost
                                const netHealthTax = revHealthFromGen - healthUncovered;
                                setTxt('bal-health-tax-rev', fmtM(revHealthFromGen));
                                setTxt('bal-health-tax-cost', fmtM(healthUncovered));
                                setTxt('bal-health-tax-net', fmtDiff(netHealthTax));
                                setClass('bal-health-tax-net', `text-right font-bold font-mono ${netHealthTax >= 0 ? 'text-emerald-400' : 'text-red-500'}`);

                                // Subtotal: Public Health
                                const subHealthRev = revHealthPool + revHealthFromGen;
                                const subHealthCost = revHealthAllocated + healthUncovered;
                                const subHealthNet = healthSurplus + netHealthTax;

                                setTxt('bal-health-sub-rev', fmtM(subHealthRev));
                                setTxt('bal-health-sub-cost', fmtM(subHealthCost));
                                setTxt('bal-health-sub-net', fmtDiff(subHealthNet));
                                setClass('bal-health-sub-net', `text-right font-bold font-mono ${subHealthNet >= 0 ? 'text-emerald-400' : 'text-red-500'}`);

                                // Law Enforcement
                                const netCrime = revCrime - totalCostCrime;
                                setTxt('bal-crime-rev', fmtM(revCrime));
                                setTxt('bal-crime-cost', fmtM(totalCostCrime));
                                setTxt('bal-crime-net', fmtDiff(netCrime));
                                setClass('bal-crime-net', `text-right font-bold font-mono ${netCrime >= 0 ? 'text-emerald-400' : 'text-red-500'}`);

                                // Social Services
                                const netSocial = revSocial - totalCostSocial;
                                setTxt('bal-social-rev', fmtM(revSocial));
                                setTxt('bal-social-cost', fmtM(totalCostSocial));
                                setTxt('bal-social-net', fmtDiff(netSocial));
                                setClass('bal-social-net', `text-right font-bold font-mono ${netSocial >= 0 ? 'text-emerald-400' : 'text-red-500'}`);

                                // Civil Legal
                                const netLegal = revLegal - totalCostLegal;
                                setTxt('bal-legal-rev', fmtM(revLegal));
                                setTxt('bal-legal-cost', fmtM(totalCostLegal));
                                setTxt('bal-legal-net', fmtDiff(netLegal));
                                setClass('bal-legal-net', `text-right font-bold font-mono ${netLegal >= 0 ? 'text-emerald-400' : 'text-red-500'}`);

                                // Subtotal: General Taxpayer Services (Law + Social + Legal)
                                const subGenRev = revCrime + revSocial + revLegal;
                                const subGenCost = totalCostCrime + totalCostSocial + totalCostLegal;
                                const subGenNet = netCrime + netSocial + netLegal;

                                setTxt('bal-gen-sub-rev', fmtM(subGenRev));
                                setTxt('bal-gen-sub-cost', fmtM(subGenCost));
                                setTxt('bal-gen-sub-net', fmtDiff(subGenNet));
                                setClass('bal-gen-sub-net', `text-right font-bold font-mono ${subGenNet >= 0 ? 'text-emerald-400' : 'text-red-500'}`);

                                // Subtotal: Total Public Burden (Public Health + General Taxpayer Services)
                                const subPublicRev = subHealthRev + subGenRev; // Should equal totalRevenue allocated effectively (minus any unallocated surplus if logic differed, but here it matches)
                                const subPublicCost = subHealthCost + subGenCost;
                                const subPublicNet = subHealthNet + subGenNet;

                                setTxt('bal-public-sub-rev', fmtM(subPublicRev));
                                setTxt('bal-public-sub-cost', fmtM(subPublicCost));
                                setTxt('bal-public-sub-net', fmtDiff(subPublicNet));
                                setClass('bal-public-sub-net', `text-right font-black font-mono ${subPublicNet >= 0 ? 'text-emerald-400' : 'text-red-500'}`);

                                // Private Sector Breakout
                                // Set Revenue to 0 for Private Sector
                                setTxt('bal-abused-rev', fmtM(0));
                                setTxt('bal-employment-rev', fmtM(0));
                                setTxt('bal-econ-sub-rev', fmtM(0));

                                // 5a. Abused Dollars
                                setTxt('bal-abused-cost', fmtM(totalCostAbused));
                                setTxt('bal-abused-net', fmtDiff(-totalCostAbused));
                                setClass('bal-abused-net', 'text-right font-mono text-red-500');

                                // 5b. Lost Employment
                                setTxt('bal-employment-cost', fmtM(totalCostEmployment));
                                setTxt('bal-employment-net', fmtDiff(-totalCostEmployment));
                                setClass('bal-employment-net', 'text-right font-mono text-red-500');

                                // Subtotal: Private Sector Impact
                                const totalCostPrivate = totalCostAbused + totalCostEmployment;
                                setTxt('bal-econ-sub-cost', fmtM(totalCostPrivate));
                                setTxt('bal-econ-sub-net', fmtDiff(-totalCostPrivate));
                                setClass('bal-econ-sub-net', 'text-right font-mono text-red-500');

                                // TOTAL NET IMPACT
                                const netTotalBalance = totalRevenue - totalCost;
                                setTxt('bal-total-rev', fmtM(totalRevenue));
                                setTxt('bal-total-cost', fmtM(totalCost));
                                setTxt('bal-total-net', fmtDiff(netTotalBalance));
                                setClass('bal-total-net', `text-right font-black font-mono text-base ${netTotalBalance >= 0 ? 'text-emerald-400' : 'text-red-500'}`);

                                // Update New Calculation Breakdowns
                                const taxEffRateActual = agrM > 0 ? (totalRevenue / (agrM * 1000000)) * 100 : 0;
                                els.calcAGR.textContent = fmtM(agrM * 1000000);
                                els.calcTaxRate.textContent = taxEffRateActual.toFixed(2) + '%';
                                els.calcTaxTotal.textContent = fmtM(totalRevenue);

                                // Update Split Allocation
                                // Humanitarian
                                els.calcRevTotalH.textContent = fmtM(totalRevenue);
                                els.calcAllocPctH.textContent = allocPct + '%';
                                els.calcAllocHumanVal.textContent = fmtM(revHealthPool);

                                // General
                                els.calcRevTotalG.textContent = fmtM(totalRevenue);
                                els.calcAllocPctG.textContent = (100 - allocPct) + '%';
                                els.calcAllocGenVal.textContent = fmtM(revGeneralPool);

                                // Update Calculation Breakdown 1
                                els.calcPop.textContent = currentPop.toLocaleString();
                                els.calcRate.textContent = gamblerGrowthRate.toFixed(2) + '%';
                                els.calcResult.textContent = victims.toLocaleString();

                                // Bar
                                let percentCovered = 0;
                                if (totalCostM > 0)
                                {
                                    percentCovered = Math.min(100, Math.max(0, (revenueM / totalCostM) * 100));
                                } else
                                {
                                    percentCovered = 100;
                                }

                                if (els.resBar) els.resBar.style.width = percentCovered + '%';

                                if (els.resFooter)
                                {
                                    if (percentCovered >= 100)
                                    {
                                        els.resFooter.innerHTML = `Revenue covers <strong class="text-white text-lg">100%</strong> of costs.`;
                                    } else
                                    {
                                        els.resFooter.innerHTML = `Tax Revenue covers only <strong class="text-white text-lg">${percentCovered.toFixed(0)}%</strong> of costs.`;
                                    }
                                }

                                // --- DYNAMIC ANALYSIS TEXT ---
                                const analysisEl = document.getElementById('analysis-text');
                                if (analysisEl)
                                {
                                    const costRatio = totalRevenue > 0 ? (totalCost / totalRevenue).toFixed(2) : "N/A";
                                    const taxEffRate = agrM > 0 ? (totalRevenue / (agrM * 1000000)) * 100 : 0;

                                    const countyInfo = countyData.find(c => c.pop === currentPop) || { name: "Selected", pop: currentPop };
                                    const baselineRateVal = parseFloat(els.inRate.value);
                                    const t1Pop = document.getElementById('val-t1').textContent;
                                    const t2Pop = document.getElementById('val-t2').textContent;
                                    const t3Pop = document.getElementById('val-t3').textContent;
                                    const t1Rate = document.getElementById('rate-t1').textContent;
                                    const t2Rate = document.getElementById('rate-t2').textContent;
                                    const t3Rate = document.getElementById('rate-t3').textContent;
                                    const effRateDisplay = document.getElementById('calc-rate').textContent;

                                    let analysisHTML = '';

                                    // 1. Disclaimer (Sub-header + Bullet)
                                    analysisHTML += `<div class="font-bold text-white mb-2 uppercase tracking-wide text-sm underline">Disclaimers</div>`;
                                    analysisHTML += `<ul class="list-disc pl-8 space-y-1 mb-4 text-slate-300">`;
                                    analysisHTML += `<li>In an effort to encourage community involvement and transparency, SaveFW has published the source code for this Economic Impact Calculator as free and open-source software (FOSS) under the AGPL-3.0 License, available on GitHub at <a href="https://github.com/savefw/casino-economic-impact-calculator" target="_blank" class="underline text-blue-400 hover:text-blue-300 transition-colors">https://github.com/savefw/casino-economic-impact-calculator</a>.</li>`;
                                    analysisHTML += `<li>SaveFW's Economic Impact Calculator does not currently include positive economic multipliers often cited by proponents (the "Economic Engine" model). SaveFW is currently evaluating the methodological appropriateness of such multipliers in a "convenience casino" market context. This classification is corroborated by the State's Spectrum Study (2025), which indicates that for a Northeast Indiana location, approximately 95% of projected revenue is sourced from the primary catchment area (residents within a 90-minute radius). This metric suggests that the project primarily facilitates a reallocation of local capital to external corporate entities, rather than introducing new capital via external tourism. Given this context, SaveFW is assessing academic literature before making a determination regarding:
                                            <ul class="list-[circle] pl-8 mt-2 space-y-3">
                                                <li><strong class="text-white">Leakage Rates:</strong> The extent to which revenue is retained locally versus exported to external corporate entities. Research from the <a href="https://www.civiceconomics.com/indie-impact.html" target="_blank" class="underline text-blue-400 hover:text-blue-300 transition-colors">Civic Economics "Indie Impact" Series</a> establishes that national corporate chains often return significantly less revenue to the local economy (approx. 14%) compared to independent local businesses (approx. 48%).</li>
                                                <li><strong class="text-white">Multiplier Magnitudes:</strong> Determining accurate local multipliers for gaming revenues. While independent local businesses typically generate multipliers of <a href="https://www.civiceconomics.com/indie-impact.html" target="_blank" class="underline text-blue-400 hover:text-blue-300 transition-colors">~1.7–2.0</a> (recirculating ~$48–$53 per $100 spent), research from the <a href="https://massgaming.com/wp-content/uploads/Social-and-Economic-Impacts-of-Casino-Introduction-to-Massachusetts_Report.pdf" target="_blank" class="underline text-blue-400 hover:text-blue-300 transition-colors">Massachusetts Gaming Commission</a> indicates that regional "convenience" casinos may yield multipliers as low as 0.5–0.7 in scenarios where local retail cannibalization is factored into the economic model.</li>
                                                <li><strong class="text-white">Net Fiscal Impact:</strong> The necessity of balancing indirect tax revenue against local expenditure substitution. Systematic reviews such as <a href="https://www.greo.ca/Modules/EvidenceCentre/Details/social-and-economic-impacts-gambling" target="_blank" class="underline text-blue-400 hover:text-blue-300 transition-colors">The Social and Economic Impacts of Gambling (2011)</a> and <a href="https://www.researchgate.net/publication/343114919_Does_Gambling_Harm_or_Benefit_Other_Industries_A_Systematic_Review" target="_blank" class="underline text-blue-400 hover:text-blue-300 transition-colors">"Does Gambling Harm or Benefit Other Industries? A Systematic Review"</a> conclude that while destination gambling can be beneficial, "convenience" gambling often substitutes for other local industries (retail and merchandise) rather than introducing new capital into the market.</li>
                                            </ul>
                                        </li>`;
                                    analysisHTML += `<li>This tool provides a programmatic economic analysis based on deterministic, rule-based logic and peer-reviewed data, rather than an artificial intelligence (AI) model or probabilistic algorithm. Unlike AI, which can be unpredictable, this programmatic approach ensures that all results are derived from fixed, transparent formulas. Common usecases for deterministic analyses occur in highly regulated fields, such as banking. At a future date, SaveFW may include functionality to generate automated analyses utilizing more than the programmatic (deterministic) approach, as well as a blended approach which mitigates weaknesses of each. To provide clarity regarding the differences between the key methodologies in the pipeline, SaveFW has outlined the key distinctions below:
                                            <ul class="list-[circle] pl-8 mt-2 space-y-3">
                                                <li><strong class="text-white">Programmatic (Deterministic) Analysis:</strong> This methodology operates on fixed-logic inputs and rigid mathematical formulas where the relationship between variables is constant. Given a specific set of parameters, the model generates an identical output in every iteration. It is used to produce exact, reproducible figures based on predefined causal relationships (e.g., $Revenue = P \times Q$).</li>
                                                <li><strong class="text-white">Probabilistic (Stochastic) Analysis:</strong> This approach treats variables as probability distributions rather than static integers to account for market volatility. By employing random sampling and statistical techniques like Monte Carlo simulations, the model calculates a range of potential outcomes and the statistical likelihood of each, typically expressed as a confidence interval.</li>
                                                <li><strong class="text-white">AI (Machine Learning) Analysis:</strong> This paradigm utilizes algorithms that identify non-linear correlations within high-dimensional datasets by developing internal weightings through training. Unlike rule-based systems, the logic is derived from statistical pattern recognition rather than human-coded formulas, allowing the model to adapt its predictive weightings as it processes new information.</li>
                                            </ul>
                                        </li>`;
                                    analysisHTML += `<li>Individuals and entities should recognize that all economic models are projections subject to data limitations and inherent variability. The responsibility for any actions or decisions made based on this analysis rests solely with the individual or entity, and SaveFW assumes no liability for the application or interpretation of these results.</li>`;
                                    analysisHTML += `</ul>`;

                                    // 2. Assumptions (Sub-header + Bullets)
                                    analysisHTML += `<div class="font-bold text-white mb-2 uppercase tracking-wide text-sm underline">Assumptions</div>`;
                                    analysisHTML += `<ul class="list-disc pl-8 space-y-1 mb-4 text-slate-300">`;
                                    analysisHTML += `<li>In the current iteration of this model, the Humanitarian Fund (${allocPct}%) is prioritized for Public Health expenditures. Future updates may include the functionality to define discrete allocations for various humanitarian initiatives.</li>`;
                                    analysisHTML += `<li>The Local Economy category represents private sector losses (productivity, debt) borne directly by households and businesses.</li>`;
                                    analysisHTML += `</ul>`;

                                    // Geographic Analysis
                                    analysisHTML += `<div class="font-bold text-white mb-2 uppercase tracking-wide text-sm underline">Geographic Analysis</div>`;
                                    analysisHTML += `<ul class="list-disc pl-8 space-y-1 mb-4 text-slate-300">`;
                                    analysisHTML += `<li><strong class="text-white">Geospatial Data:</strong> Population and boundary data aggregated via <a href="https://censusreporter.org" target="_blank" class="underline text-blue-400 hover:text-blue-300 transition-colors">CensusReporter.org</a> (Source: U.S. Census Bureau, 2020 Decennial Block Groups). Data files were processed, merged, and simplified using <a href="https://mapshaper.org" target="_blank" class="underline text-blue-400 hover:text-blue-300 transition-colors">Mapshaper.org</a>.</li>`;
                                    analysisHTML += `<li><strong class="text-white">Scope of Analysis:</strong> The current version of the Economic Impact Calculator limits its analysis to the singular county being assessed. It does not factor spillover impact to neighboring counties in Indiana or neighboring states when the impact radius extends beyond county limits.</li>`;
                                    analysisHTML += `<li><strong class="text-white">Assessed Area:</strong> This analysis focuses on ${countyInfo.name} County, with a total population of ${countyInfo.pop.toLocaleString()}.</li>`;

                                    // Proximity Model with programmatic Baseline details
                                    let baselineDesc = '';
                                    if (baselineRateVal === 2.3)
                                    {
                                        baselineDesc = `Indiana's Diagnosed Rate (2.3%), which represents Hoosiers meeting clinical criteria for Gambling Disorder (2023)`;
                                    } else if (baselineRateVal === 3.0)
                                    {
                                        baselineDesc = `Indiana's Problem Rate (3.0%), derived from self-reported 'problems with gambling' in state surveys`;
                                    } else if (baselineRateVal === 5.5)
                                    {
                                        baselineDesc = `the National Average (5.5%), representing the broader combined At-Risk and Problem gambling rate`;
                                    } else
                                    {
                                        const variance = ((baselineRateVal - 2.3) / 2.3) * 100;
                                        const varianceStr = variance > 0 ? `+${variance.toFixed(1)}%` : `${variance.toFixed(1)}%`;
                                        baselineDesc = `a Custom Rate of ${baselineRateVal.toFixed(1)}%, which is a <strong class="${variance > 0 ? 'text-red-400' : 'text-emerald-400'}">${varianceStr}</strong> variance from Indiana's Diagnosed Rate (2.3%)`;
                                    }

                                    analysisHTML += `<li><strong class="text-white">Impact Distribution:</strong> This distribution models the increased statistical likelihood of residents developing problem gambling behaviors (Gambling Disorder) based on their geographic proximity to the casino site.
                                            <ul class="list-[circle] pl-8 mt-2 space-y-2">
                                                <li><strong class="text-white">High Risk Zone (0-10 miles):</strong> ${t1Pop} residents are subject to a ${t1Rate} prevalence rate due to immediate proximity.</li>
                                                <li><strong class="text-white">Elevated Risk Zone (10-20 miles):</strong> ${t2Pop} residents are subject to a ${t2Rate} prevalence rate.</li>`;

                                    if (t3Pop === 'Fully Captured' || t3Pop === '0')
                                    {
                                        analysisHTML += `<li><strong class="text-white">Baseline Risk Zone (>20 miles):</strong> The High and Elevated Risk zones encompass the entire county population, leaving effectively zero residents in the baseline risk category.</li>`;
                                    } else
                                    {
                                        analysisHTML += `<li><strong class="text-white">Baseline Risk Zone (>20 miles):</strong> ${t3Pop} residents are subject to the baseline ${t3Rate} rate.</li>`;
                                    }
                                    analysisHTML += `</ul></li>`;
                                    analysisHTML += `<li><strong class="text-white">Prevalence Outcome:</strong> The resulting net effective problem gambler growth rate is ${effRateDisplay}, projecting ${victims.toLocaleString()} new problem gamblers within the county.</li>`;
                                    analysisHTML += `</ul>`;

                                    // 4. Analysis (Split into sections)

                                    // A. TAX REVENUE
                                    analysisHTML += `<div class="font-bold text-white mb-2 uppercase tracking-wide text-sm underline">Tax Revenue Analysis</div>`;
                                    analysisHTML += '<ul class="list-disc pl-8 space-y-3 mb-4 text-slate-300">';
                                    analysisHTML += `<li><strong class="text-white">Adjusted Gross Revenue (AGR):</strong> The projected base of ${fmtM(agrM * 1000000)} represent the total wealth extracted from gamblers. Unlike standard sales or property taxes, gambling revenue is subject to a unique progressive structure in Indiana, utilizing a 3.5% supplemental tax and tiered brackets that scale based on volume.</li>`;
                                    analysisHTML += `<li><strong class="text-white">Effective Tax Rate:</strong> For this scenario, the calculated effective tax rate is ${taxEffRate.toFixed(2)}%, resulting in ${fmtM(totalRevenue)} in estimated public tax revenue.</li>`;
                                    analysisHTML += `<li><strong class="text-white">Revenue Allocation:</strong> The model directs ${allocPct}% (${fmtM(revHealthPool)}) to the Humanitarian Fund and ${100 - allocPct}% (${fmtM(revGeneralPool)}) to the General Fund. This General Fund portion is distributed pro rata (proportionally based on share of total cost) towards addressing remaining burdens: Law Enforcement, Social Services, and Civil Legal.</li>`;
                                    analysisHTML += '</ul>';

                                    // B. SOCIAL COSTS
                                    analysisHTML += `<div class="font-bold text-white mb-2 uppercase tracking-wide text-sm underline">Social Cost Analysis</div>`;
                                    analysisHTML += '<ul class="list-disc pl-8 space-y-3 mb-4 text-slate-300">';
                                    analysisHTML += `<li><strong class="text-white">Data Source:</strong> Baseline social cost valuations are derived from peer-reviewed research by <a href="https://www.senate.ga.gov/committees/Documents/HiddenCostsofGam.pdf" target="_blank" class="underline text-blue-400 hover:text-blue-300 transition-colors">Grinols</a> (2011), with values adjusted for 2025 inflation to reflect current economic conditions.</li>`;
                                    // Public Health
                                    if (revHealthPool >= totalCostHealth)
                                    {
                                        analysisHTML += `<li><strong class="text-white">Public Health:</strong> The ${allocPct}% Humanitarian allocation is fully sufficient to cover the projected ${fmtM(totalCostHealth)} in Public Health costs. This surplus enables proactive recovery initiatives, which can stabilize vulnerable households and reduce long-term homelessness.</li>`;
                                    } else
                                    {
                                        analysisHTML += `<li><strong class="text-white">Public Health:</strong> The projected Public Health costs exceed the capacity of the ${allocPct}% Humanitarian allocation, leaving a funding gap for addiction and mental health treatments. This shortfall risks exacerbating homelessness and straining emergency medical services as untreated conditions escalate.</li>`;
                                    }
                                    // General Taxpayer Services Analysis (Dollar Amounts)

                                    // Law Enforcement
                                    const gapCrime = totalCostCrime - revCrime;
                                    if (gapCrime > 0)
                                    {
                                        analysisHTML += `<li><strong class="text-white">Law Enforcement:</strong> The department faces a projected deficit of ${fmtM(gapCrime)}, necessitating a reduction in operational throughput. This budgetary deficit is projected to result in increased response latencies, diminished clearance rates for property crimes, and a reduced capacity to manage the anticipated surge in domestic disturbance calls.</li>`;
                                    } else
                                    {
                                        analysisHTML += `<li><strong class="text-white">Law Enforcement:</strong> The department projects a budget surplus of ${fmtM(Math.abs(gapCrime))}, positioning it to maintain high operational readiness. This additional capacity enables the implementation of enhanced community policing initiatives and the establishment of specialized units dedicated to investigating complex financial crimes.</li>`;
                                    }

                                    // Social Services
                                    const gapSocial = totalCostSocial - revSocial;
                                    if (gapSocial > 0)
                                    {
                                        analysisHTML += `<li><strong class="text-white">Social Services:</strong> This sector faces a projected deficit of ${fmtM(gapSocial)}, diminishing the programmatic efficacy of the regional social safety net. A deficit of this magnitude risks exceeding the throughput capacity of the foster care system and restricts the availability of essential support resources for households experiencing displacement or foreclosure.</li>`;
                                    } else
                                    {
                                        analysisHTML += `<li><strong class="text-white">Social Services:</strong> With a projected surplus of ${fmtM(Math.abs(gapSocial))}, the county can maintain a robust and stable safety net. This financial stability facilitates the expansion of proactive family stabilization programs and ensures adequate resource availability for food banks and emergency housing assistance.</li>`;
                                    }

                                    // Courts (Civil Legal)
                                    const gapLegal = totalCostLegal - revLegal;
                                    if (gapLegal > 0)
                                    {
                                        analysisHTML += `<li><strong class="text-white">Civil Legal (Courts):</strong> The judicial system faces a projected deficit of ${fmtM(gapLegal)}, resulting in systemic administrative bottlenecks. This budgetary deficit is anticipated to generate substantial backlogs in bankruptcy proceedings, extended processing delays for divorce and custody hearings, and an inability to manage the projected volume of eviction cases efficiently.</li>`;
                                    } else
                                    {
                                        analysisHTML += `<li><strong class="text-white">Civil Legal (Courts):</strong> The system projects a budget surplus of ${fmtM(Math.abs(gapLegal))}, equipping it to maintain operational efficiency despite increased caseloads. This financial capacity facilitates the timely processing of civil matters and provides necessary funding for mediation services and diversion programs.</li>`;
                                    }

                                    // Private Sector (Local Economy) Breakout
                                    analysisHTML += `<li><strong class="text-white">Abused Dollars:</strong> The private sector faces a projected unmitigated loss of ${fmtM(totalCostAbused)}. This represents direct wealth extraction from households where financial resources are diverted from essential needs and savings to service gambling debts, reducing overall local purchasing power.</li>`;

                                    analysisHTML += `<li><strong class="text-white">Lost Employment:</strong> The local economy is projected to incur ${fmtM(totalCostEmployment)} in losses due to reduced workforce productivity. This includes costs associated with absenteeism, termination of problem gamblers, and the friction costs of rehiring and retraining, effectively operating as a hidden tax on local employers.</li>`;

                                    analysisHTML += '</ul>';

                                    // C. NET ECONOMIC IMPACT
                                    analysisHTML += `<div class="font-bold text-white mb-2 uppercase tracking-wide text-sm underline">Net Economic Impact Analysis</div>`;
                                    analysisHTML += '<ul class="list-disc pl-8 space-y-3 text-slate-300">';

                                    analysisHTML += `<li><strong class="text-white">Sector Comparison:</strong> The Public Sector (government departments) projected impact is a ${fmtM(Math.abs(subPublicNet))} ${subPublicNet >= 0 ? 'surplus' : 'deficit'}. In comparison, the Private Sector (Local Economy) faces an unmitigated loss of ${fmtM(totalCostPrivate)}.</li>`;

                                    if (netTotalBalance < 0)
                                    {
                                        analysisHTML += `<li><strong class="text-white">Fiscal Conclusion:</strong> The projected social costs exceed the direct tax revenue, resulting in a net fiscal deficit for the county. The projected ${fmtM(totalRevenue)} in revenue is significantly surpassed by ${fmtM(totalCost)} in projected social cost liabilities, leaving taxpayers with a ${fmtM(Math.abs(netTotalBalance))} annual net fiscal deficit.</li>`;
                                        analysisHTML += `<li><strong class="text-white">Cost-to-Benefit Ratio:</strong> For every $1 in tax revenue generated, the county is projected to incur $${costRatio} in social costs (crime, bankruptcy, lost productivity).</li>`;

                                        const deficitM = Math.abs(netTotalBalance) / 1000000;
                                        if (deficitM > 50)
                                        {
                                            analysisHTML += `<li><strong class="text-white">Secondary Offsets:</strong> Given the magnitude of this deficit (${fmtM(Math.abs(netTotalBalance))}), it is statistically unlikely that unmodeled economic multipliers or indirect tax benefits would be sufficient to mitigate the shortfall. Proponents would need to demonstrate substantial secondary economic activity to neutralize such a significant fiscal gap.</li>`;
                                        } else
                                        {
                                            analysisHTML += `<li><strong class="text-white">Secondary Offsets:</strong> While this model does not account for economic multipliers or indirect tax benefits, proponents would need to demonstrate that such factors can generate at least ${fmtM(Math.abs(netTotalBalance))} in additional value to achieve a fiscal break-even point.</li>`;
                                        }
                                    } else
                                    {
                                        analysisHTML += `<li><strong class="text-white">Fiscal Conclusion:</strong> Under this specific configuration of variables, the casino generates a net fiscal surplus. The projected revenue of ${fmtM(totalRevenue)} exceeds the estimated social cost liabilities of ${fmtM(totalCost)}.</li>`;
                                    }

                                    analysisHTML += '</ul>';
                                    analysisEl.innerHTML = analysisHTML;
                                }
                            }

                            // Listeners
                            els.inCounty.addEventListener('change', calculate);
                            els.inRevenue.addEventListener('input', calculate);
                            els.inAGR.addEventListener('input', calculate);
                            els.inRate.addEventListener('input', calculate);
                            els.inAllocation.addEventListener('input', calculate); // New Listener

                            els.inCostCrime.addEventListener('input', calculate);
                            els.inCostBusiness.addEventListener('input', calculate);
                            els.inCostBankruptcy.addEventListener('input', calculate);
                            els.inCostIllness.addEventListener('input', calculate);
                            els.inCostServices.addEventListener('input', calculate);
                            els.inCostAbused.addEventListener('input', calculate);

                            // Map Event Listener
                            window.addEventListener('county-selected-map', (e) =>
                            {
                                selectCounty(e.detail.name, e.detail.pop);
                            });

                            // Init
                            initCounties();
                            calculate();


};
</script>
                </div>
            </div>
        </div>

        <!-- Table -->
        <!--
            <div class="mt-12 bg-slate-800 border border-slate-700 rounded-3xl p-4 sm:p-8 shadow-sm">
                <h4 class="font-bold text-white text-lg mb-6 flex items-center gap-2">
                    <span class="material-symbols-outlined text-blue-500">table_chart</span>
                    SaveFW's Estimated Analysis
                </h4>
                <div class="overflow-x-auto rounded-xl border border-slate-700">
                    <table class="w-full text-sm text-left">
                        <thead
                            class="bg-slate-950 text-slate-300 uppercase text-xs font-bold border-b border-slate-700">
                            <tr>
                                <th class="px-6 py-4">Projection Model</th>
                                <th class="px-6 py-4 text-center">New Problem Gamblers</th>
                                <th class="px-6 py-4 text-center">Annual Social Cost</th>
                                <th class="px-6 py-4 text-right">Net Annual Deficit</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-slate-700 bg-slate-800">
                            <tr class="hover:bg-slate-700/50 transition-colors">
                                <td class="px-6 py-4 font-bold text-white">Low End Estimate</td>
                                <td class="px-6 py-4 text-center font-mono text-white">5,872
                                </td>
                                <td class="px-6 py-4 text-center font-mono text-red-500">$77.5 Million</td>
                                <td class="px-6 py-4 text-right font-black text-red-600 font-mono">-$50.0 Million
                                </td>
                            </tr>
                            <tr class="hover:bg-slate-700/50 transition-colors">
                                <td class="px-6 py-4 font-bold text-white">High End Estimate
                                </td>
                                <td class="px-6 py-4 text-center font-mono text-white">
                                    12,918
                                </td>
                                <td class="px-6 py-4 text-center font-mono text-red-500">$170.5 Million</td>
                                <td class="px-6 py-4 text-right font-black text-red-600 font-mono">-$143.0 Million
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
                <p class="mt-4 text-xs text-slate-400 text-center">
                    Based on local population (391,449), problem gambling rates of 1.5% to 3.3% within 20 miles of a
                    casino, and social costs adjusted for inflation.
                </p>
            </div>
            -->
        <!-- End Table -->
        </div>

        <!-- PART II: THE MYTH OF NET GROWTH (Moved Here) -->
        <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 mt-24 border-t border-slate-700 pt-24">
            <!-- Header -->
            <div class="mb-12 text-center" id="economic-analysis-part-2">
                <span class="text-blue-500 font-bold tracking-wider uppercase text-base">Economic Analysis - Part
                    II</span>
                <h2 class="mt-2 text-3xl font-black tracking-tight text-white sm:text-5xl leading-tight">
                    THE MYTH OF <br><span class="text-blue-500">NET GROWTH</span>
                </h2>
                <div class="mt-4 text-xl italic text-slate-400 leading-relaxed">
                    <p>
                        The primary economic argument for the Fort Wayne casino is that it will generate "new" money.
                        This assumes it functions as a tourist destination. However, in markets lacking high-density
                        attractions, casinos operate as <strong>"convenience gambling"</strong> venues, leading to the
                        <strong>Substitution Effect</strong>.
                    </p>
                </div>
            </div>

            <div
                class="mb-16 bg-slate-800 shadow-lg rounded-3xl border border-slate-700 p-6 sm:p-8 backdrop-blur-sm relative overflow-hidden">
                <div class="text-left relative z-10">
                    <h4 class="text-white font-bold mb-4 flex items-center gap-2 text-xl">
                        <span class="material-symbols-outlined text-blue-500 text-3xl">analytics</span>
                        Evidence: Spectrum Study (2025)
                    </h4>
                    <p class="mb-4 text-slate-400">
                        A critical analysis of the Spectrum Study (2025) provides the most definitive evidence against
                        the "Economic Engine" narrative. The study's own data admits that for a Northeast Indiana
                        location, <strong>nearly 95% of the revenue is expected to come from the "core market-catchment
                            area" (residents within 90 minutes)</strong>. This statistic mathematically disproves the
                        "tourism" argument. If 95% of the money originates from local pockets, there is no "New Money"
                        being introduced; it is purely a <strong>wealth transfer</strong> from Fort Wayne families to a
                        corporate entity, with the city retaining only a small "convenience fee" in the form of tax
                        revenue.
                    </p>

                    <h4 class="text-white font-bold mt-6 mb-4 flex items-center gap-2 text-xl">
                        <span class="material-symbols-outlined text-red-500 text-3xl">block</span>
                        Market Saturation & Competitive Landscape
                    </h4>
                    <p class="mb-4 text-slate-400">
                        To function as a genuine destination, a venue must offer a unique value proposition that
                        transcends local alternatives. However, the Northeast Indiana market is already saturated by
                        established competitors:
                    </p>
                    <ul class="list-disc pl-5 space-y-2 mb-6 text-slate-400">
                        <li><strong>South Bend:</strong> Four Winds</li>
                        <li><strong>Toledo:</strong> Hollywood Casino</li>
                        <li><strong>Battle Creek:</strong> FireKeepers</li>
                        <li><strong>Indianapolis:</strong> Horseshoe (Shelbyville)</li>
                    </ul>
                    <p class="font-bold text-white border-l-4 border-blue-500 pl-4 py-1">
                        Conclusion: Given the proximity of these established gaming centers, a standard regional casino
                        lacks the requisite differentiation to attract significant external tourism, as potential
                        visitors are already served by closer facilities.
                    </p>
                </div>
            </div>

            <!-- Interactive Substitution Visualizer -->
            <div
                class="mb-16 bg-slate-800 shadow-lg rounded-3xl border border-slate-700 p-4 sm:p-8 backdrop-blur-sm relative overflow-hidden">
                <!-- Background accent -->
                <div class="absolute top-0 right-0 -mr-20 -mt-20 w-64 h-64 bg-blue-500/10 rounded-full blur-3xl p-6">
                </div>

                <div class="text-center mb-10 relative z-10">

                    <h3 class="text-2xl font-bold text-white flex items-center justify-center gap-3">
                        <span class="material-symbols-outlined text-emerald-400 text-3xl">account_balance_wallet</span>
                        Household Discretionary Budget: $500/mo
                    </h3>
                    <p class="text-slate-400 text-base mt-3 max-w-2xl mx-auto">
                        See how the local economy suffers when spending shifts. The total household budget for
                        entertainment is fixed.
                        When a casino enters, it doesn't create new money; it eats into existing categories.
                    </p>
                </div>

                <div class="grid md:grid-cols-2 gap-12 items-center relative z-10">
                    <!-- Before -->
                    <div class="flex flex-col items-center">
                        <h4 class="text-white font-bold mb-6 flex items-center gap-2">
                            <span class="bg-slate-700 text-slate-200 text-sm px-2 py-1 rounded">Current State</span>
                            Before Casino
                        </h4>
                        <div class="w-64 h-64 relative">
                            <canvas id="chartBefore"></canvas>
                        </div>
                        <div class="mt-6 text-center">
                            <p class="text-base font-medium text-emerald-400">100% Local Circulation</p>
                            <p class="text-sm text-slate-500 mt-1">Money recirculates 5-7 times in the local economy.
                            </p>
                        </div>
                    </div>

                    <!-- After -->
                    <div class="flex flex-col items-center relative">
                        <h4 class="text-white font-bold mb-6 flex items-center gap-2">
                            <span
                                class="bg-red-900/30 text-red-400 text-sm px-2 py-1 rounded border border-red-900/50">Future
                                State</span>
                            After Casino
                        </h4>

                        <div class="w-64 h-64 relative">
                            <canvas id="chartAfter"></canvas>
                        </div>
                        <div class="mt-6 text-center">
                            <p class="text-base font-medium text-red-400">25-30% Wealth Extraction</p>
                            <p class="text-sm text-slate-500 mt-1">Casino profits are exported to external investors.
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Legend -->
                <div
                    class="mt-10 flex flex-wrap justify-center gap-6 text-sm font-medium text-slate-400 border-t border-slate-700/50 pt-6">
                    <div class="flex items-center gap-2">
                        <div class="w-3 h-3 rounded-full bg-[#3b82f6]"></div> Retail (Clothes, Hobbies)
                    </div>
                    <div class="flex items-center gap-2">
                        <div class="w-3 h-3 rounded-full bg-[#8b5cf6]"></div> Dining & Restaurants
                    </div>
                    <div class="flex items-center gap-2">
                        <div class="w-3 h-3 rounded-full bg-[#10b981]"></div> Local Entertainment
                    </div>
                    <div class="flex items-center gap-2">
                        <div class="w-3 h-3 rounded-full bg-[#f97316]"></div> Savings
                    </div>
                    <div class="flex items-center gap-2">
                        <div class="w-3 h-3 rounded-full bg-[#ef4444]"></div> Casino Loss
                    </div>
                </div>
            </div>

            <!-- Chart.js and Logic -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
window.initSubstitutionCharts = function() {
                    const commonOptions = {
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: {
                            legend: { display: false },
                            tooltip: {
                                callbacks: {
                                    label: function (context)
                                    {
                                        return context.label + ': $' + context.raw;
                                    }
                                },
                                backgroundColor: 'rgba(15, 23, 42, 0.95)', // Dark tooltips
                                titleColor: '#fff',
                                bodyColor: '#cbd5e1',
                                borderColor: 'rgba(148, 163, 184, 0.5)',
                                borderWidth: 1,
                                padding: 10
                            }
                        },
                        layout: { padding: 10 }
                    };

                    // Data
                    const labels = ['Retail', 'Dining', 'Local Ent.', 'Savings', 'Casino'];
                    const bgColors = ['#3b82f6', '#8b5cf6', '#10b981', '#f97316', '#ef4444'];

                    // Chart 1: Before ($500)
                    const ctxBefore = document.getElementById('chartBefore').getContext('2d');
                    new Chart(ctxBefore, {
                        type: 'doughnut',
                        data: {
                            labels: ['Retail', 'Dining', 'Local Ent.', 'Savings'],
                            datasets: [{
                                data: [150, 150, 100, 100],
                                backgroundColor: bgColors.slice(0, 4),
                                borderWidth: 0,
                                hoverOffset: 10
                            }]
                        },
                        options: commonOptions,
                        plugins: [{
                            id: 'centerText',
                            beforeDraw: function (chart)
                            {
                                var width = chart.width,
                                    height = chart.height,
                                    ctx = chart.ctx;
                                ctx.restore();
                                var fontSize = (height / 114).toFixed(2);
                                ctx.font = "bold " + fontSize + "em sans-serif";
                                ctx.textBaseline = "middle";
                                ctx.fillStyle = "#ffffff"; // White Text
                                var text = "$500",
                                    textX = Math.round((width - ctx.measureText(text).width) / 2),
                                    textY = height / 2;
                                ctx.fillText(text, textX, textY);
                                ctx.save();
                            }
                        }]
                    });

                    // Chart 2: After ($500)
                    const ctxAfter = document.getElementById('chartAfter').getContext('2d');
                    new Chart(ctxAfter, {
                        type: 'doughnut',
                        data: {
                            labels: labels,
                            datasets: [{
                                data: [100, 100, 75, 75, 150],
                                backgroundColor: bgColors,
                                borderWidth: 0,
                                hoverOffset: 10
                            }]
                        },
                        options: commonOptions,
                        plugins: [{
                            id: 'centerText',
                            beforeDraw: function (chart)
                            {
                                var width = chart.width,
                                    height = chart.height,
                                    ctx = chart.ctx;
                                ctx.restore();
                                var fontSize = (height / 114).toFixed(2);
                                ctx.font = "bold " + fontSize + "em sans-serif";
                                ctx.textBaseline = "middle";
                                ctx.fillStyle = "#ffffff"; // White text
                                var text = "$500",
                                    textX = Math.round((width - ctx.measureText(text).width) / 2),
                                    textY = height / 2;
                                ctx.fillText(text, textX, textY);
                                ctx.save();
                            }
                        }]
                    });
};
</script>
            <div class="grid lg:grid-cols-2 gap-8 items-start">
                <!-- Left Column: The Data -->
                <div>
                    <!-- Substitution Effect Card -->
                    <div class="bg-slate-800 shadow-lg rounded-3xl border border-slate-700 p-8 backdrop-blur-sm h-full">
                        <h3 class="text-2xl font-bold text-white mb-6 flex items-center gap-3">
                            <span class="material-symbols-outlined text-blue-500">sync_problem</span>
                            Mechanics of the Substitution Effect
                        </h3>
                        <p class="text-slate-400 mb-6 leading-relaxed">
                            For a casino to generate net growth, it must function as an "export" industry—bringing
                            in
                            outside dollars. If it merely recirculates local capital, the net impact is neutral or
                            negative.
                            <br><br>
                            Research by the <strong>Federal Reserve Bank of St. Louis</strong> notes that in
                            mid-sized urban
                            areas, casinos often correlate with a <em>stagnation or decrease</em> in local retail
                            sales. The
                            casino acts as a gravitational well, absorbing liquidity that formerly supported small
                            businesses.
                        </p>

                        <!-- Data Callout -->
                        <div class="bg-red-900/20 border-l-4 border-red-500 p-6 rounded-r-xl mb-8">
                            <h4 class="text-lg font-bold text-red-500 mb-2">"243" Coefficient</h4>
                            <p class="text-slate-300 text-base">
                                For every <strong>$1,000 increase</strong> in casino revenue, businesses within a
                                10-30 mile
                                radius experience a <strong>loss of approximately $243</strong> in sales.
                            </p>
                        </div>

                        <!-- Displacement Table -->
                        <div class="overflow-x-auto rounded-xl border border-slate-700">
                            <table class="w-full text-left text-base text-slate-400">
                                <thead class="bg-slate-900 text-slate-300 uppercase font-bold text-sm">
                                    <tr>
                                        <th class="px-6 py-4">Metric</th>
                                        <th class="px-6 py-4">Value</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-slate-700 bg-slate-800">
                                    <tr>
                                        <td class="px-6 py-4 font-medium text-white">Projected Casino AGR</td>
                                        <td class="px-6 py-4 text-emerald-400 font-bold">$204.3M</td>
                                    </tr>
                                    <tr>
                                        <td class="px-6 py-4 font-medium text-white">Displacement Coefficient</td>
                                        <td class="px-6 py-4 text-orange-400 font-bold">24.3%</td>
                                    </tr>
                                    <tr class="bg-red-900/10">
                                        <td class="px-6 py-4 font-bold text-white">Projected Local Loss</td>
                                        <td class="px-6 py-4 text-red-500 font-black">($49.6M)</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Right Column: The Context -->
                <div class="space-y-6">
                    <!-- Factory vs Restaurant -->
                    <div class="grid sm:grid-cols-2 gap-4">
                        <div class="bg-slate-800 shadow-sm p-6 rounded-3xl border-l-4 border-red-500">
                            <div class="text-red-500 font-bold uppercase tracking-widest text-sm mb-2">Fallacy
                            </div>
                            <h3 class="text-lg font-bold text-white mb-2">"Economic Development"</h3>
                            <p class="text-slate-400 text-sm leading-relaxed">
                                Proponents claim the casino expands the economic pie, ignoring the reality of
                                convenience gaming.
                            </p>
                        </div>
                        <div class="bg-slate-800 shadow-sm p-6 rounded-3xl border-l-4 border-emerald-500">
                            <div class="text-emerald-500 font-bold uppercase tracking-widest text-sm mb-2">The
                                Reality</div>
                            <h3 class="text-lg font-bold text-white mb-2">Factory vs. Restaurant</h3>
                            <p class="text-slate-400 text-sm leading-relaxed">
                                A local casino merely competes for the <strong>existing pool</strong> of
                                entertainment dollars like a restaurant.
                            </p>
                        </div>
                    </div>

                    <!-- Recession Risk -->
                    <div class="bg-slate-800 shadow-sm rounded-3xl p-8 border-l-4 border-yellow-500">
                        <h3 class="text-xl font-bold text-white mb-2">Recessionary Vulnerability</h3>
                        <p class="text-slate-400 text-base mb-4 leading-relaxed">
                            During the 2007-2012 Recession, retail sales in casino-hosting economies <strong>grew 3x
                                slower</strong> (2.4%) than in non-casino economies (8.6%).
                        </p>
                        <p class="text-white italic font-medium text-base">
                            "Introducing a casino introduces a structural weakness apparent during recession."
                        </p>
                    </div>

                    <!-- Economic Monoculture -->
                    <div class="bg-slate-800 shadow-sm rounded-3xl p-8 border-l-4 border-blue-500">
                        <h3 class="text-xl font-bold text-white mb-2">Economic Monoculture</h3>
                        <p class="text-slate-400 text-base leading-relaxed">
                            The casino acts as an invasive species, displacing diverse local businesses and creating
                            a <strong>single point of failure</strong>.
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </section>

@code {
    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            await Task.Delay(500); // Wait for DOM
            try { await JSRuntime.InvokeVoidAsync("window.initEconomicCalculator"); } catch (Exception e) { Console.WriteLine($"Calc Init: {e.Message}"); }
            try { await JSRuntime.InvokeVoidAsync("window.initSubstitutionCharts"); } catch (Exception e) { Console.WriteLine($"Chart Init: {e.Message}"); }
        }
    }
    // Helpers for safety, though HTML controls logic
    private string FmtM(double val) { return "$" + (val / 1_000_000).ToString("F1") + "MM"; }
    private string FmtDiff(double val) { return (val >= 0 ? "+$" : "-$") + Math.Abs(val / 1_000_000).ToString("F1") + "MM"; }
    private string NetClass(double val) { return val >= 0 ? "text-emerald-400" : "text-red-500"; }
}
