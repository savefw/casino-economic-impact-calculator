@inject IJSRuntime JSRuntime

<div class="mb-16 bg-slate-800 shadow-lg rounded-3xl border border-slate-700 p-4 sm:p-8 backdrop-blur-sm relative overflow-hidden" id="economic-analysis-part-2">
    <!-- Background accent -->
    <div class="absolute top-0 right-0 -mr-20 -mt-20 w-64 h-64 bg-blue-500/10 rounded-full blur-3xl p-6"></div>

    <div class="text-center mb-10 relative z-10">
        <h3 class="text-2xl font-bold text-white flex items-center justify-center gap-3">
            <span class="material-symbols-outlined text-emerald-400 text-3xl">account_balance_wallet</span>
            Household Discretionary Budget: $500/mo
        </h3>
        <p class="text-slate-400 text-base mt-3 max-w-2xl mx-auto">
            See how the local economy suffers when spending shifts. The total household budget for
            entertainment is fixed.
            When a casino enters, it doesn't create new money; it eats into existing categories.
        </p>
    </div>

    <div class="grid md:grid-cols-2 gap-12 items-center relative z-10">
        <!-- Before -->
        <div class="flex flex-col items-center">
            <h4 class="text-white font-bold mb-6 flex items-center gap-2">
                <span class="bg-slate-700 text-slate-200 text-sm px-2 py-1 rounded">Current State</span>
                Before Casino
            </h4>
            <div class="w-64 h-64 relative">
                <canvas id="chartBefore"></canvas>
            </div>
            <div class="mt-6 text-center">
                <p class="text-base font-medium text-emerald-400">100% Local Circulation</p>
                <p class="text-sm text-slate-500 mt-1">Money recirculates 5-7 times in the local economy.</p>
            </div>
        </div>

        <!-- After -->
        <div class="flex flex-col items-center relative">
            <h4 class="text-white font-bold mb-6 flex items-center gap-2">
                <span class="bg-red-900/30 text-red-400 text-sm px-2 py-1 rounded border border-red-900/50">Future State</span>
                After Casino
            </h4>

            <div class="w-64 h-64 relative">
                <canvas id="chartAfter"></canvas>
            </div>
            <div class="mt-6 text-center">
                <p class="text-base font-medium text-red-400">25-30% Wealth Extraction</p>
                <p class="text-sm text-slate-500 mt-1">Casino profits are exported to external investors.</p>
            </div>
        </div>
    </div>

    <!-- Legend -->
    <div class="mt-10 flex flex-wrap justify-center gap-6 text-sm font-medium text-slate-400 border-t border-slate-700/50 pt-6">
        <div class="flex items-center gap-2">
            <div class="w-3 h-3 rounded-full bg-[#3b82f6]"></div> Retail (Clothes, Hobbies)
        </div>
        <div class="flex items-center gap-2">
            <div class="w-3 h-3 rounded-full bg-[#8b5cf6]"></div> Dining & Restaurants
        </div>
        <div class="flex items-center gap-2">
            <div class="w-3 h-3 rounded-full bg-[#10b981]"></div> Local Entertainment
        </div>
        <div class="flex items-center gap-2">
            <div class="w-3 h-3 rounded-full bg-[#f97316]"></div> Savings
        </div>
        <div class="flex items-center gap-2">
            <div class="w-3 h-3 rounded-full bg-[#ef4444]"></div> Casino Loss
        </div>
    </div>
</div>

@code {
    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            await JSRuntime.InvokeVoidAsync("window.SubstitutionEffect.init");
        }
    }
}
