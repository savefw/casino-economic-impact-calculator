@inject IJSRuntime JSRuntime
@namespace SaveFW.Client.Components

<div id="@Id" class="pb-10" @ref="containerRef">
    <div class="mb-4 mt-10">
        <label class="text-base font-bold text-white block mb-2">@Label</label>
        
        <div class="flex justify-between items-baseline mb-2 bg-slate-800 p-2 rounded-lg border border-slate-700">
            <span class="text-sm font-bold text-slate-500 uppercase">Total</span>
            <span class="text-red-500 font-bold font-mono text-lg" id="val-@Id-total">$0</span>
        </div>

        @if (!string.IsNullOrEmpty(Description))
        {
            <p class="text-sm text-slate-400 italic mb-4">@Description</p>
        }
    </div>

    <div class="space-y-12 pl-2 group-inputs">
        @ChildContent
    </div>
</div>

@code {
    [Parameter] public string Id { get; set; } = Guid.NewGuid().ToString("N");
    [Parameter] public string Label { get; set; } = "";
    [Parameter] public string Description { get; set; } = "";
    [Parameter] public RenderFragment? ChildContent { get; set; }

    private ElementReference containerRef;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        // Always try to init. JS handles idempotency.
        try 
        {
            await JSRuntime.InvokeVoidAsync("window.SliderInputGroupLogic.init", containerRef, $"val-{Id}-total");
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error initializing SliderInputGroup {Id}: {ex.Message}");
        }
    }
}
